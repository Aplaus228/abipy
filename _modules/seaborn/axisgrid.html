<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>seaborn.axisgrid &#8212; abipy 0.7.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my_style.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          abipy</a>
        <span class="navbar-text navbar-version pull-left"><b>0.7.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Getting AbiPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zzbiblio.html">Bibliography</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/index.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery/index.html">AbiPy Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../postprocessing_howto.html">Post-processing How-To</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/taskmanager.html">TaskManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/manager_examples.html">Manager Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../flow_gallery/index.html">Flow Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../flows_howto.html">Flows How-To</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coding_guide.html">Coding guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Documenting AbiPy</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for seaborn.axisgrid</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">distutils.version</span> <span class="k">import</span> <span class="n">LooseVersion</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="k">import</span> <span class="n">dedent</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">.palettes</span> <span class="k">import</span> <span class="n">color_palette</span><span class="p">,</span> <span class="n">blend_palette</span>
<span class="kn">from</span> <span class="nn">.external.six</span> <span class="k">import</span> <span class="n">string_types</span>
<span class="kn">from</span> <span class="nn">.distributions</span> <span class="k">import</span> <span class="n">distplot</span><span class="p">,</span> <span class="n">kdeplot</span><span class="p">,</span>  <span class="n">_freedman_diaconis_bins</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;FacetGrid&quot;</span><span class="p">,</span> <span class="s2">&quot;PairGrid&quot;</span><span class="p">,</span> <span class="s2">&quot;JointGrid&quot;</span><span class="p">,</span> <span class="s2">&quot;pairplot&quot;</span><span class="p">,</span> <span class="s2">&quot;jointplot&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Grid</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for grids of subplots.&quot;&quot;&quot;</span>
    <span class="n">_margin_titles</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_legend_out</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set attributes on each subplot Axes.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">savefig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the figure.&quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;bbox_inches&quot;</span><span class="p">,</span> <span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_legend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">legend_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw a legend, maybe placing it outside axes and resizing the figure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        legend_data : dict, optional</span>
<span class="sd">            Dictionary mapping label names to matplotlib artist handles. The</span>
<span class="sd">            default reads from ``self._legend_data``.</span>
<span class="sd">        title : string, optional</span>
<span class="sd">            Title for the legend. The default reads from ``self._hue_var``.</span>
<span class="sd">        label_order : list of labels, optional</span>
<span class="sd">            The order that the legend entries should appear in. The default</span>
<span class="sd">            reads from ``self.hue_names``.</span>
<span class="sd">        kwargs : key, value pairings</span>
<span class="sd">            Other keyword arguments are passed to the underlying legend methods</span>
<span class="sd">            on the Figure or Axes object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Grid instance</span>
<span class="sd">            Returns self for easy chaining.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find the data for the legend</span>
        <span class="n">legend_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_legend_data</span> <span class="k">if</span> <span class="n">legend_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">legend_data</span>
        <span class="k">if</span> <span class="n">label_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">legend_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">to_utf8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">))</span>

        <span class="n">blank_handle</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">legend_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">blank_handle</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">label_order</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hue_var</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">title</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">title_size</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelsize&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">85</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># labelsize is something like &quot;large&quot;</span>
            <span class="n">title_size</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelsize&quot;</span><span class="p">]</span>

        <span class="c1"># Set default legend kwargs</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;scatterpoints&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_legend_out</span><span class="p">:</span>

            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;frameon&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Draw a full-figure legend outside the grid</span>
            <span class="n">figlegend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">label_order</span><span class="p">,</span> <span class="s2">&quot;center right&quot;</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_legend</span> <span class="o">=</span> <span class="n">figlegend</span>
            <span class="n">figlegend</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">title_size</span><span class="p">})</span>

            <span class="c1"># Draw the plot to set the bounding boxes correctly</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="s2">&quot;get_renderer&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_renderer</span><span class="p">())</span>

            <span class="c1"># Calculate and set the new width of the figure so the legend fits</span>
            <span class="n">legend_width</span> <span class="o">=</span> <span class="n">figlegend</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi</span>
            <span class="n">fig_width</span><span class="p">,</span> <span class="n">fig_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fig_width</span> <span class="o">+</span> <span class="n">legend_width</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">)</span>

            <span class="c1"># Draw the plot again to get the new transformations</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="s2">&quot;get_renderer&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_renderer</span><span class="p">())</span>

            <span class="c1"># Now calculate how much space we need on the right side</span>
            <span class="n">legend_width</span> <span class="o">=</span> <span class="n">figlegend</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi</span>
            <span class="n">space_needed</span> <span class="o">=</span> <span class="n">legend_width</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_width</span> <span class="o">+</span> <span class="n">legend_width</span><span class="p">)</span>
            <span class="n">margin</span> <span class="o">=</span> <span class="o">.</span><span class="mi">04</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_margin_titles</span> <span class="k">else</span> <span class="o">.</span><span class="mi">01</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_space_needed</span> <span class="o">=</span> <span class="n">margin</span> <span class="o">+</span> <span class="n">space_needed</span>
            <span class="n">right</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_space_needed</span>

            <span class="c1"># Place the subplot axes to give space for the legend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Draw a legend in the first axis</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">label_order</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">title_size</span><span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_clean_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn off axis labels and legend.&quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_update_legend_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract the legend data from an axes object and save it.&quot;&quot;&quot;</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="p">:</span> <span class="n">h</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_legend_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_palette</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span> <span class="n">palette</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a list of colors for the hue variable.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">palette</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">n_colors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">hue_names</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">categorical_order</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">hue</span><span class="p">],</span> <span class="n">hue_order</span><span class="p">)</span>
            <span class="n">n_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hue_names</span><span class="p">)</span>

            <span class="c1"># By default use either the current color palette or HUSL</span>
            <span class="k">if</span> <span class="n">palette</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">current_palette</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_color_cycle</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">n_colors</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_palette</span><span class="p">):</span>
                    <span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;husl&quot;</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">n_colors</span><span class="o">=</span><span class="n">n_colors</span><span class="p">)</span>

            <span class="c1"># Allow for palette to map from hue variable names</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">palette</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">color_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">palette</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hue_names</span><span class="p">]</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">color_names</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>

            <span class="c1"># Otherwise act as if we just got a list of colors</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">palette</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>

            <span class="n">palette</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">palette</span>


<span class="n">_facet_docs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>

    <span class="n">data</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    data : DataFrame</span>
<span class="s2">        Tidy (&quot;long-form&quot;) dataframe where each column is a variable and each</span>
<span class="s2">        row is an observation.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">col_wrap</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    col_wrap : int, optional</span>
<span class="s2">        &quot;Wrap&quot; the column variable at this width, so that the column facets</span>
<span class="s2">        span multiple rows. Incompatible with a ``row`` facet.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">share_xy</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    share{x,y} : bool, &#39;col&#39;, or &#39;row&#39; optional</span>
<span class="s2">        If true, the facets will share y axes across columns and/or x axes</span>
<span class="s2">        across rows.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">height</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    height : scalar, optional</span>
<span class="s2">        Height (in inches) of each facet. See also: ``aspect``.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">aspect</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    aspect : scalar, optional</span>
<span class="s2">        Aspect ratio of each facet, so that ``aspect * height`` gives the width</span>
<span class="s2">        of each facet in inches.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">palette</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    palette : palette name, list, or dict, optional</span>
<span class="s2">        Colors to use for the different levels of the ``hue`` variable. Should</span>
<span class="s2">        be something that can be interpreted by :func:`color_palette`, or a</span>
<span class="s2">        dictionary mapping hue levels to matplotlib colors.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">legend_out</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    legend_out : bool, optional</span>
<span class="s2">        If ``True``, the figure size will be extended, and the legend will be</span>
<span class="s2">        drawn outside the plot on the center right.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">margin_titles</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    margin_titles : bool, optional</span>
<span class="s2">        If ``True``, the titles for the row variable are drawn to the right of</span>
<span class="s2">        the last column. This option is experimental and may not work in all</span>
<span class="s2">        cases.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">FacetGrid</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Multi-plot grid for plotting conditional relationships.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">row_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">despine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">margin_titles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subplot_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">gridspec_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">MPL_GRIDSPEC_VERSION</span> <span class="o">=</span> <span class="n">LooseVersion</span><span class="p">(</span><span class="s1">&#39;1.4&#39;</span><span class="p">)</span>
        <span class="n">OLD_MPL</span> <span class="o">=</span> <span class="n">LooseVersion</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MPL_GRIDSPEC_VERSION</span>

        <span class="c1"># Handle deprecations</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">size</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The `size` paramter has been renamed to `height`; &quot;</span>
                   <span class="s2">&quot;please update your code.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

        <span class="c1"># Determine the hue facet layer information</span>
        <span class="n">hue_var</span> <span class="o">=</span> <span class="n">hue</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hue_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hue_names</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">categorical_order</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">hue</span><span class="p">],</span> <span class="n">hue_order</span><span class="p">)</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_palette</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span> <span class="n">palette</span><span class="p">)</span>

        <span class="c1"># Set up the lists of names for the row and column facet variables</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">row_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row_names</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">categorical_order</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">row_order</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">col_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_names</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">categorical_order</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">col_order</span><span class="p">)</span>

        <span class="c1"># Additional dict of kwarg -&gt; list of values for mapping the hue var</span>
        <span class="n">hue_kws</span> <span class="o">=</span> <span class="n">hue_kws</span> <span class="k">if</span> <span class="n">hue_kws</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="c1"># Make a boolean mask that is True anywhere there is an NA</span>
        <span class="c1"># value in one of the faceting variables, but only if dropna is True</span>
        <span class="n">none_na</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
            <span class="n">row_na</span> <span class="o">=</span> <span class="n">none_na</span> <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
            <span class="n">col_na</span> <span class="o">=</span> <span class="n">none_na</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
            <span class="n">hue_na</span> <span class="o">=</span> <span class="n">none_na</span> <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="n">hue</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
            <span class="n">not_na</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">row_na</span> <span class="o">|</span> <span class="n">col_na</span> <span class="o">|</span> <span class="n">hue_na</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">not_na</span> <span class="o">=</span> <span class="o">~</span><span class="n">none_na</span>

        <span class="c1"># Compute the grid shape</span>
        <span class="n">ncol</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_names</span><span class="p">)</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_facets</span> <span class="o">=</span> <span class="n">ncol</span> <span class="o">*</span> <span class="n">nrow</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_col_wrap</span> <span class="o">=</span> <span class="n">col_wrap</span>
        <span class="k">if</span> <span class="n">col_wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;Cannot use `row` and `col_wrap` together.&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="n">col_wrap</span>
            <span class="n">nrow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_names</span><span class="p">)</span> <span class="o">/</span> <span class="n">col_wrap</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">=</span> <span class="n">ncol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">=</span> <span class="n">nrow</span>

        <span class="c1"># Calculate the base figure size</span>
        <span class="c1"># This can get stretched later by a legend</span>
        <span class="c1"># TODO this doesn&#39;t account for axis labels</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncol</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

        <span class="c1"># Validate some inputs</span>
        <span class="k">if</span> <span class="n">col_wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">margin_titles</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Build the subplot keyword dictionary</span>
        <span class="n">subplot_kws</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">subplot_kws</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">subplot_kws</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">gridspec_kws</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">gridspec_kws</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">gridspec_kws</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subplot_kws</span><span class="p">[</span><span class="s2">&quot;xlim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span>
        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subplot_kws</span><span class="p">[</span><span class="s2">&quot;ylim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span>

        <span class="c1"># Initialize the subplot grid</span>
        <span class="k">if</span> <span class="n">col_wrap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span>
                          <span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kws</span><span class="p">,</span>
                          <span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kws</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">OLD_MPL</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;gridspec_kw&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gridspec_kws</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;gridspec module only available in mpl &gt;= </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MPL_GRIDSPEC_VERSION</span><span class="p">))</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If wrapping the col variable we need to make the grid ourselves</span>
            <span class="k">if</span> <span class="n">gridspec_kws</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;`gridspec_kws` ignored when using `col_wrap`&quot;</span><span class="p">)</span>

            <span class="n">n_axes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_names</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_axes</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">subplot_kws</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sharex</span><span class="p">:</span>
                <span class="n">subplot_kws</span><span class="p">[</span><span class="s2">&quot;sharex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sharey</span><span class="p">:</span>
                <span class="n">subplot_kws</span><span class="p">[</span><span class="s2">&quot;sharey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_axes</span><span class="p">):</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">subplot_kws</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>

            <span class="c1"># Now we turn off labels on the inner axes</span>
            <span class="k">if</span> <span class="n">sharex</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_not_bottom_axes</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                        <span class="n">label</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">offsetText</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sharey</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_not_left_axes</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
                        <span class="n">label</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">offsetText</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Set up the class attributes</span>
        <span class="c1"># ---------------------------</span>

        <span class="c1"># First the public API</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">row_names</span> <span class="o">=</span> <span class="n">row_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_names</span> <span class="o">=</span> <span class="n">col_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="o">=</span> <span class="n">hue_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hue_kws</span> <span class="o">=</span> <span class="n">hue_kws</span>

        <span class="c1"># Next the private variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">=</span> <span class="n">nrow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_row_var</span> <span class="o">=</span> <span class="n">row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">=</span> <span class="n">ncol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_col_var</span> <span class="o">=</span> <span class="n">col</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_margin_titles</span> <span class="o">=</span> <span class="n">margin_titles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_col_wrap</span> <span class="o">=</span> <span class="n">col_wrap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hue_var</span> <span class="o">=</span> <span class="n">hue_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_legend_out</span> <span class="o">=</span> <span class="n">legend_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_legend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_legend_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_var</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_var</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dropna</span> <span class="o">=</span> <span class="n">dropna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_not_na</span> <span class="o">=</span> <span class="n">not_na</span>

        <span class="c1"># Make the axes look good</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">despine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

    <span class="fm">__init__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        Initialize the matplotlib figure and FacetGrid object.</span>

<span class="s2">        This class maps a dataset onto multiple axes arrayed in a grid of rows</span>
<span class="s2">        and columns that correspond to *levels* of variables in the dataset.</span>
<span class="s2">        The plots it produces are often called &quot;lattice&quot;, &quot;trellis&quot;, or</span>
<span class="s2">        &quot;small-multiple&quot; graphics.</span>

<span class="s2">        It can also represent levels of a third varaible with the ``hue``</span>
<span class="s2">        parameter, which plots different subets of data in different colors.</span>
<span class="s2">        This uses color to resolve elements on a third dimension, but only</span>
<span class="s2">        draws subsets on top of each other and will not tailor the ``hue``</span>
<span class="s2">        parameter for the specific visualization the way that axes-level</span>
<span class="s2">        functions that accept ``hue`` will.</span>

<span class="s2">        When using seaborn functions that infer semantic mappings from a</span>
<span class="s2">        dataset, care must be taken to synchronize those mappings across</span>
<span class="s2">        facets. In most cases, it will be better to use a figure-level function</span>
<span class="s2">        (e.g. :func:`relplot` or :func:`catplot`) than to use</span>
<span class="s2">        :class:`FacetGrid` directly.</span>

<span class="s2">        The basic workflow is to initialize the :class:`FacetGrid` object with</span>
<span class="s2">        the dataset and the variables that are used to structure the grid. Then</span>
<span class="s2">        one or more plotting functions can be applied to each subset by calling</span>
<span class="s2">        :meth:`FacetGrid.map` or :meth:`FacetGrid.map_dataframe`. Finally, the</span>
<span class="s2">        plot can be tweaked with other methods to do things like change the</span>
<span class="s2">        axis labels, use different ticks, or add a legend. See the detailed</span>
<span class="s2">        code examples below for more information.</span>

<span class="s2">        See the :ref:`tutorial &lt;grid_tutorial&gt;` for more information.</span>

<span class="s2">        Parameters</span>
<span class="s2">        ----------</span>
<span class="s2">        </span><span class="si">{data}</span><span class="s2"></span>
<span class="s2">        row, col, hue : strings</span>
<span class="s2">            Variables that define subsets of the data, which will be drawn on</span>
<span class="s2">            separate facets in the grid. See the ``*_order`` parameters to</span>
<span class="s2">            control the order of levels of this variable.</span>
<span class="s2">        </span><span class="si">{col_wrap}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{share_xy}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{height}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{aspect}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">        {{row,col,hue}}_order : lists, optional</span>
<span class="s2">            Order for the levels of the faceting variables. By default, this</span>
<span class="s2">            will be the order that the levels appear in ``data`` or, if the</span>
<span class="s2">            variables are pandas categoricals, the category order.</span>
<span class="s2">        hue_kws : dictionary of param -&gt; list of values mapping</span>
<span class="s2">            Other keyword arguments to insert into the plotting call to let</span>
<span class="s2">            other plot attributes vary across levels of the hue variable (e.g.</span>
<span class="s2">            the markers in a scatterplot).</span>
<span class="s2">        </span><span class="si">{legend_out}</span><span class="s2"></span>
<span class="s2">        despine : boolean, optional</span>
<span class="s2">            Remove the top and right spines from the plots.</span>
<span class="s2">        </span><span class="si">{margin_titles}</span><span class="s2"></span>
<span class="s2">        {{x, y}}lim: tuples, optional</span>
<span class="s2">            Limits for each of the axes on each facet (only relevant when</span>
<span class="s2">            share{{x, y}} is True.</span>
<span class="s2">        subplot_kws : dict, optional</span>
<span class="s2">            Dictionary of keyword arguments passed to matplotlib subplot(s)</span>
<span class="s2">            methods.</span>
<span class="s2">        gridspec_kws : dict, optional</span>
<span class="s2">            Dictionary of keyword arguments passed to matplotlib&#39;s ``gridspec``</span>
<span class="s2">            module (via ``plt.subplots``). Requires matplotlib &gt;= 1.4 and is</span>
<span class="s2">            ignored if ``col_wrap`` is not ``None``.</span>

<span class="s2">        See Also</span>
<span class="s2">        --------</span>
<span class="s2">        PairGrid : Subplot grid for plotting pairwise relationships.</span>
<span class="s2">        relplot : Combine a relational plot and a :class:`FacetGrid`.</span>
<span class="s2">        catplot : Combine a categorical plot and a :class:`FacetGrid`.</span>
<span class="s2">        lmplot : Combine a regression plot and a :class:`FacetGrid`.</span>

<span class="s2">        Examples</span>
<span class="s2">        --------</span>

<span class="s2">        Initialize a 2x2 grid of facets using the tips dataset:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; import seaborn as sns; sns.set(style=&quot;ticks&quot;, color_codes=True)</span>
<span class="s2">            &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;time&quot;, row=&quot;smoker&quot;)</span>

<span class="s2">        Draw a univariate plot on each facet:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;time&quot;,  row=&quot;smoker&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = g.map(plt.hist, &quot;total_bill&quot;)</span>

<span class="s2">        (Note that it&#39;s not necessary to re-catch the returned variable; it&#39;s</span>
<span class="s2">        the same object, but doing so in the examples makes dealing with the</span>
<span class="s2">        doctests somewhat less annoying).</span>

<span class="s2">        Pass additional keyword arguments to the mapped function:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; import numpy as np</span>
<span class="s2">            &gt;&gt;&gt; bins = np.arange(0, 65, 5)</span>
<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;time&quot;,  row=&quot;smoker&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = g.map(plt.hist, &quot;total_bill&quot;, bins=bins, color=&quot;r&quot;)</span>

<span class="s2">        Plot a bivariate function on each facet:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;time&quot;,  row=&quot;smoker&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = g.map(plt.scatter, &quot;total_bill&quot;, &quot;tip&quot;, edgecolor=&quot;w&quot;)</span>

<span class="s2">        Assign one of the variables to the color of the plot elements:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;time&quot;,  hue=&quot;smoker&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(plt.scatter, &quot;total_bill&quot;, &quot;tip&quot;, edgecolor=&quot;w&quot;)</span>
<span class="s2">            ...       .add_legend())</span>

<span class="s2">        Change the height and aspect ratio of each facet:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;day&quot;, height=4, aspect=.5)</span>
<span class="s2">            &gt;&gt;&gt; g = g.map(plt.hist, &quot;total_bill&quot;, bins=bins)</span>

<span class="s2">        Specify the order for plot elements:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;smoker&quot;, col_order=[&quot;Yes&quot;, &quot;No&quot;])</span>
<span class="s2">            &gt;&gt;&gt; g = g.map(plt.hist, &quot;total_bill&quot;, bins=bins, color=&quot;m&quot;)</span>

<span class="s2">        Use a different color palette:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; kws = dict(s=50, linewidth=.5, edgecolor=&quot;w&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;sex&quot;, hue=&quot;time&quot;, palette=&quot;Set1&quot;,</span>
<span class="s2">            ...                   hue_order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(plt.scatter, &quot;total_bill&quot;, &quot;tip&quot;, **kws)</span>
<span class="s2">            ...      .add_legend())</span>

<span class="s2">        Use a dictionary mapping hue levels to colors:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; pal = dict(Lunch=&quot;seagreen&quot;, Dinner=&quot;gray&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;sex&quot;, hue=&quot;time&quot;, palette=pal,</span>
<span class="s2">            ...                   hue_order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(plt.scatter, &quot;total_bill&quot;, &quot;tip&quot;, **kws)</span>
<span class="s2">            ...      .add_legend())</span>

<span class="s2">        Additionally use a different marker for the hue levels:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;sex&quot;, hue=&quot;time&quot;, palette=pal,</span>
<span class="s2">            ...                   hue_order=[&quot;Dinner&quot;, &quot;Lunch&quot;],</span>
<span class="s2">            ...                   hue_kws=dict(marker=[&quot;^&quot;, &quot;v&quot;]))</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(plt.scatter, &quot;total_bill&quot;, &quot;tip&quot;, **kws)</span>
<span class="s2">            ...      .add_legend())</span>

<span class="s2">        &quot;Wrap&quot; a column variable with many levels into the rows:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; att = sns.load_dataset(&quot;attention&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(att, col=&quot;subject&quot;, col_wrap=5, height=1.5)</span>
<span class="s2">            &gt;&gt;&gt; g = g.map(plt.plot, &quot;solutions&quot;, &quot;score&quot;, marker=&quot;.&quot;)</span>

<span class="s2">        Define a custom bivariate function to map onto the grid:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; from scipy import stats</span>
<span class="s2">            &gt;&gt;&gt; def qqplot(x, y, **kwargs):</span>
<span class="s2">            ...     _, xr = stats.probplot(x, fit=False)</span>
<span class="s2">            ...     _, yr = stats.probplot(y, fit=False)</span>
<span class="s2">            ...     plt.scatter(xr, yr, **kwargs)</span>
<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;smoker&quot;, hue=&quot;sex&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(qqplot, &quot;total_bill&quot;, &quot;tip&quot;, **kws)</span>
<span class="s2">            ...       .add_legend())</span>

<span class="s2">        Define a custom function that uses a ``DataFrame`` object and accepts</span>
<span class="s2">        column names as positional variables:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; import pandas as pd</span>
<span class="s2">            &gt;&gt;&gt; df = pd.DataFrame(</span>
<span class="s2">            ...     data=np.random.randn(90, 4),</span>
<span class="s2">            ...     columns=pd.Series(list(&quot;ABCD&quot;), name=&quot;walk&quot;),</span>
<span class="s2">            ...     index=pd.date_range(&quot;2015-01-01&quot;, &quot;2015-03-31&quot;,</span>
<span class="s2">            ...                         name=&quot;date&quot;))</span>
<span class="s2">            &gt;&gt;&gt; df = df.cumsum(axis=0).stack().reset_index(name=&quot;val&quot;)</span>
<span class="s2">            &gt;&gt;&gt; def dateplot(x, y, **kwargs):</span>
<span class="s2">            ...     ax = plt.gca()</span>
<span class="s2">            ...     data = kwargs.pop(&quot;data&quot;)</span>
<span class="s2">            ...     data.plot(x=x, y=y, ax=ax, grid=False, **kwargs)</span>
<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(df, col=&quot;walk&quot;, col_wrap=2, height=3.5)</span>
<span class="s2">            &gt;&gt;&gt; g = g.map_dataframe(dateplot, &quot;date&quot;, &quot;val&quot;)</span>

<span class="s2">        Use different axes labels after plotting:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;smoker&quot;, row=&quot;sex&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(plt.scatter, &quot;total_bill&quot;, &quot;tip&quot;, color=&quot;g&quot;, **kws)</span>
<span class="s2">            ...       .set_axis_labels(&quot;Total bill (US Dollars)&quot;, &quot;Tip&quot;))</span>

<span class="s2">        Set other attributes that are shared across the facetes:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;smoker&quot;, row=&quot;sex&quot;)</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(plt.scatter, &quot;total_bill&quot;, &quot;tip&quot;, color=&quot;r&quot;, **kws)</span>
<span class="s2">            ...       .set(xlim=(0, 60), ylim=(0, 12),</span>
<span class="s2">            ...            xticks=[10, 30, 50], yticks=[2, 6, 10]))</span>

<span class="s2">        Use a different template for the facet titles:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;size&quot;, col_wrap=3)</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(plt.hist, &quot;tip&quot;, bins=np.arange(0, 13), color=&quot;c&quot;)</span>
<span class="s2">            ...       .set_titles(&quot;{{col_name}} diners&quot;))</span>

<span class="s2">        Tighten the facets:</span>

<span class="s2">        .. plot::</span>
<span class="s2">            :context: close-figs</span>

<span class="s2">            &gt;&gt;&gt; g = sns.FacetGrid(tips, col=&quot;smoker&quot;, row=&quot;sex&quot;,</span>
<span class="s2">            ...                   margin_titles=True)</span>
<span class="s2">            &gt;&gt;&gt; g = (g.map(plt.scatter, &quot;total_bill&quot;, &quot;tip&quot;, color=&quot;m&quot;, **kws)</span>
<span class="s2">            ...       .set(xlim=(0, 60), ylim=(0, 12),</span>
<span class="s2">            ...            xticks=[10, 30, 50], yticks=[2, 6, 10])</span>
<span class="s2">            ...       .fig.subplots_adjust(wspace=.05, hspace=.05))</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_facet_docs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">facet_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generator for name indices and data subsets for each facet.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        (i, j, k), data_ijk : tuple of ints, DataFrame</span>
<span class="sd">            The ints provide an index into the {row, col, hue}_names attribute,</span>
<span class="sd">            and the dataframe contains a subset of the full data corresponding</span>
<span class="sd">            to each facet. The generator yields subsets that correspond with</span>
<span class="sd">            the self.axes.flat iterator, or self.axes[i, j] when `col_wrap`</span>
<span class="sd">            is None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Construct masks for the row variable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_names</span><span class="p">:</span>
            <span class="n">row_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_row_var</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_names</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))]</span>

        <span class="c1"># Construct masks for the column variable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_names</span><span class="p">:</span>
            <span class="n">col_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_col_var</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_names</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))]</span>

        <span class="c1"># Construct masks for the hue variable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">:</span>
            <span class="n">hue_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hue_var</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hue_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))]</span>

        <span class="c1"># Here is the main generator loop</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">col</span><span class="p">),</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">hue</span><span class="p">)</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">row_masks</span><span class="p">),</span>
                                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">col_masks</span><span class="p">),</span>
                                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">hue_masks</span><span class="p">)):</span>
            <span class="n">data_ijk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">row</span> <span class="o">&amp;</span> <span class="n">col</span> <span class="o">&amp;</span> <span class="n">hue</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_not_na</span><span class="p">]</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">data_ijk</span>

    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply a plotting function to each facet&#39;s subset of the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            A plotting function that takes data and keyword arguments. It</span>
<span class="sd">            must plot to the currently active matplotlib Axes and take a</span>
<span class="sd">            `color` keyword argument. If faceting on the `hue` dimension,</span>
<span class="sd">            it must also take a `label` keyword argument.</span>
<span class="sd">        args : strings</span>
<span class="sd">            Column names in self.data that identify variables with data to</span>
<span class="sd">            plot. The data for each variable is passed to `func` in the</span>
<span class="sd">            order the variables are specified in the call.</span>
<span class="sd">        kwargs : keyword arguments</span>
<span class="sd">            All keyword arguments are passed to the plotting function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : object</span>
<span class="sd">            Returns self.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If color was a keyword argument, grab it here</span>
        <span class="n">kw_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s2">&quot;__module__&quot;</span><span class="p">):</span>
            <span class="n">func_module</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func_module</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Check for categorical plots without order information</span>
        <span class="k">if</span> <span class="n">func_module</span> <span class="o">==</span> <span class="s2">&quot;seaborn.categorical&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;order&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">warning</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Using the </span><span class="si">{}</span><span class="s2"> function without specifying &quot;</span>
                           <span class="s2">&quot;`order` is likely to produce an incorrect &quot;</span>
                           <span class="s2">&quot;plot.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="s2">&quot;hue_order&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">warning</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Using the </span><span class="si">{}</span><span class="s2"> function without specifying &quot;</span>
                           <span class="s2">&quot;`hue_order` is likely to produce an incorrect &quot;</span>
                           <span class="s2">&quot;plot.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span>

        <span class="c1"># Iterate over the data subsets</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">row_i</span><span class="p">,</span> <span class="n">col_j</span><span class="p">,</span> <span class="n">hue_k</span><span class="p">),</span> <span class="n">data_ijk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet_data</span><span class="p">():</span>

            <span class="c1"># If this subset is null, move on</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data_ijk</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Get the current axis</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet_axis</span><span class="p">(</span><span class="n">row_i</span><span class="p">,</span> <span class="n">col_j</span><span class="p">)</span>

            <span class="c1"># Decide what color to plot with</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facet_color</span><span class="p">(</span><span class="n">hue_k</span><span class="p">,</span> <span class="n">kw_color</span><span class="p">)</span>

            <span class="c1"># Insert the other hue aesthetics if appropriate</span>
            <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_kws</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_list</span><span class="p">[</span><span class="n">hue_k</span><span class="p">]</span>

            <span class="c1"># Insert a label in the keyword arguments for the legend</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hue_var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_utf8</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">[</span><span class="n">hue_k</span><span class="p">])</span>

            <span class="c1"># Get the actual data we are going to plot with</span>
            <span class="n">plot_data</span> <span class="o">=</span> <span class="n">data_ijk</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dropna</span><span class="p">:</span>
                <span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="n">plot_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()]</span>

            <span class="c1"># Some matplotlib functions don&#39;t handle pandas objects correctly</span>
            <span class="k">if</span> <span class="n">func_module</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">):</span>
                <span class="n">plot_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">plot_args</span><span class="p">]</span>

            <span class="c1"># Draw the plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_facet_plot</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">plot_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Finalize the annotations and layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_grid</span><span class="p">(</span><span class="n">args</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">map_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Like ``.map`` but passes args as strings and inserts data in kwargs.</span>

<span class="sd">        This method is suitable for plotting with functions that accept a</span>
<span class="sd">        long-form DataFrame as a `data` keyword argument and access the</span>
<span class="sd">        data in that DataFrame using string variable names.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            A plotting function that takes data and keyword arguments. Unlike</span>
<span class="sd">            the `map` method, a function used here must &quot;understand&quot; Pandas</span>
<span class="sd">            objects. It also must plot to the currently active matplotlib Axes</span>
<span class="sd">            and take a `color` keyword argument. If faceting on the `hue`</span>
<span class="sd">            dimension, it must also take a `label` keyword argument.</span>
<span class="sd">        args : strings</span>
<span class="sd">            Column names in self.data that identify variables with data to</span>
<span class="sd">            plot. The data for each variable is passed to `func` in the</span>
<span class="sd">            order the variables are specified in the call.</span>
<span class="sd">        kwargs : keyword arguments</span>
<span class="sd">            All keyword arguments are passed to the plotting function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : object</span>
<span class="sd">            Returns self.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If color was a keyword argument, grab it here</span>
        <span class="n">kw_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Iterate over the data subsets</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">row_i</span><span class="p">,</span> <span class="n">col_j</span><span class="p">,</span> <span class="n">hue_k</span><span class="p">),</span> <span class="n">data_ijk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet_data</span><span class="p">():</span>

            <span class="c1"># If this subset is null, move on</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data_ijk</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Get the current axis</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet_axis</span><span class="p">(</span><span class="n">row_i</span><span class="p">,</span> <span class="n">col_j</span><span class="p">)</span>

            <span class="c1"># Decide what color to plot with</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facet_color</span><span class="p">(</span><span class="n">hue_k</span><span class="p">,</span> <span class="n">kw_color</span><span class="p">)</span>

            <span class="c1"># Insert the other hue aesthetics if appropriate</span>
            <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_kws</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_list</span><span class="p">[</span><span class="n">hue_k</span><span class="p">]</span>

            <span class="c1"># Insert a label in the keyword arguments for the legend</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hue_var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">[</span><span class="n">hue_k</span><span class="p">]</span>

            <span class="c1"># Stick the facet dataframe into the kwargs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dropna</span><span class="p">:</span>
                <span class="n">data_ijk</span> <span class="o">=</span> <span class="n">data_ijk</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_ijk</span>

            <span class="c1"># Draw the plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_facet_plot</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Finalize the annotations and layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_grid</span><span class="p">(</span><span class="n">args</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_facet_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hue_index</span><span class="p">,</span> <span class="n">kw_color</span><span class="p">):</span>

        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span><span class="p">[</span><span class="n">hue_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kw_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kw_color</span>
        <span class="k">elif</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">color</span>

    <span class="k">def</span> <span class="nf">_facet_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">plot_args</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="p">):</span>

        <span class="c1"># Draw the plot</span>
        <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">plot_args</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="c1"># Sort out the supporting information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clean_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finalize_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axlabels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finalize the annotations and layout.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="o">*</span><span class="n">axlabels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_titles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">facet_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_i</span><span class="p">,</span> <span class="n">col_j</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the axis identified by these indices active and return it.&quot;&quot;&quot;</span>

        <span class="c1"># Calculate the actual indices of the axes to plot on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">col_j</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">row_i</span><span class="p">,</span> <span class="n">col_j</span><span class="p">]</span>

        <span class="c1"># Get a reference to the axes object we want, and make it active</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">despine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove axis spines from the facets.&quot;&quot;&quot;</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_axis_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_var</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_var</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set axis labels on the left column and bottom row of the grid.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x_var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_var</span> <span class="o">=</span> <span class="n">x_var</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_xlabels</span><span class="p">(</span><span class="n">x_var</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_var</span> <span class="o">=</span> <span class="n">y_var</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_ylabels</span><span class="p">(</span><span class="n">y_var</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_xlabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Label the x axis on the bottom row of the grid.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_var</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bottom_axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_ylabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Label the y axis on the left column of the grid.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_var</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set x axis tick labels on the bottom row of the grid.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()]</span>
                <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xticks</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[::</span><span class="n">step</span><span class="p">]</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[::</span><span class="n">step</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set y axis tick labels on the left column of the grid.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_titles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row_template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">col_template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw titles either above each facet or on the grid margins.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        template : string</span>
<span class="sd">            Template for all titles with the formatting keys {col_var} and</span>
<span class="sd">            {col_name} (if using a `col` faceting variable) and/or {row_var}</span>
<span class="sd">            and {row_name} (if using a `row` faceting variable).</span>
<span class="sd">        row_template:</span>
<span class="sd">            Template for the row variable when titles are drawn on the grid</span>
<span class="sd">            margins. Must have {row_var} and {row_name} formatting keys.</span>
<span class="sd">        col_template:</span>
<span class="sd">            Template for the row variable when titles are drawn on the grid</span>
<span class="sd">            margins. Must have {col_var} and {col_name} formatting keys.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self: object</span>
<span class="sd">            Returns self.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">row_var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_row_var</span><span class="p">,</span> <span class="n">col_var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_col_var</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelsize&quot;</span><span class="p">])</span>

        <span class="c1"># Establish default templates</span>
        <span class="k">if</span> <span class="n">row_template</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">row_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{row_var}</span><span class="s2"> = </span><span class="si">{row_name}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">col_template</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">col_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{col_var}</span><span class="s2"> = </span><span class="si">{col_name}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_row_var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">col_template</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">row_template</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">row_template</span><span class="p">,</span> <span class="n">col_template</span><span class="p">])</span>

        <span class="n">row_template</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_utf8</span><span class="p">(</span><span class="n">row_template</span><span class="p">)</span>
        <span class="n">col_template</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_utf8</span><span class="p">(</span><span class="n">col_template</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_utf8</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_margin_titles</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Draw the row titles on the right edge of the grid</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_names</span><span class="p">):</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">row_name</span><span class="o">=</span><span class="n">row_name</span><span class="p">))</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">row_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                    <span class="n">bgcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span>
                                <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                                <span class="n">backgroundcolor</span><span class="o">=</span><span class="n">bgcolor</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Draw the column titles  as normal titles</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_names</span><span class="p">):</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="n">col_name</span><span class="p">))</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">col_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># Otherwise title each facet with all the necessary information</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_row_var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_col_var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_names</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_names</span><span class="p">):</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">row_name</span><span class="o">=</span><span class="n">row_name</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="n">col_name</span><span class="p">))</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_names</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">row_name</span><span class="o">=</span><span class="n">row_name</span><span class="p">))</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_names</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="n">col_name</span><span class="p">))</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                <span class="c1"># Index the flat array so col_wrap works</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Easy access to single axes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You must use the `.axes` attribute (an array) when &quot;</span>
                   <span class="s2">&quot;there is more than one plot.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_inner_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a flat array of the inner axes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_wrap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">flat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n_empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_facets</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="n">append</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="ow">and</span>
                          <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="ow">and</span>
                          <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">n_empty</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_left_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a flat array of the left column of axes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_wrap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span><span class="p">:</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_not_left_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a flat array of axes that aren&#39;t on the left column.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_wrap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">flat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span><span class="p">:</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_bottom_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a flat array of the bottom row of axes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_wrap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n_empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_facets</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="n">append</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="ow">or</span>
                          <span class="n">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">n_empty</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_not_bottom_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a flat array of axes that aren&#39;t on the bottom row.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_wrap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n_empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_facets</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="n">append</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="ow">and</span>
                          <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncol</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">n_empty</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span>


<span class="k">class</span> <span class="nc">PairGrid</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Subplot grid for plotting pairwise relationships in a dataset.</span>

<span class="sd">    This class maps each variable in a dataset onto a column and row in a</span>
<span class="sd">    grid of multiple axes. Different axes-level plotting functions can be</span>
<span class="sd">    used to draw bivariate plots in the upper and lower triangles, and the</span>
<span class="sd">    the marginal distribution of each variable can be shown on the diagonal.</span>

<span class="sd">    It can also represent an additional level of conditionalization with the</span>
<span class="sd">    ``hue`` parameter, which plots different subets of data in different</span>
<span class="sd">    colors. This uses color to resolve elements on a third dimension, but</span>
<span class="sd">    only draws subsets on top of each other and will not tailor the ``hue``</span>
<span class="sd">    parameter for the specific visualization the way that axes-level functions</span>
<span class="sd">    that accept ``hue`` will.</span>

<span class="sd">    See the :ref:`tutorial &lt;grid_tutorial&gt;` for more information.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">hue_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">diag_sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">despine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the plot figure and PairGrid object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : DataFrame</span>
<span class="sd">            Tidy (long-form) dataframe where each column is a variable and</span>
<span class="sd">            each row is an observation.</span>
<span class="sd">        hue : string (variable name), optional</span>
<span class="sd">            Variable in ``data`` to map plot aspects to different colors.</span>
<span class="sd">        hue_order : list of strings</span>
<span class="sd">            Order for the levels of the hue variable in the palette</span>
<span class="sd">        palette : dict or seaborn color palette</span>
<span class="sd">            Set of colors for mapping the ``hue`` variable. If a dict, keys</span>
<span class="sd">            should be values  in the ``hue`` variable.</span>
<span class="sd">        hue_kws : dictionary of param -&gt; list of values mapping</span>
<span class="sd">            Other keyword arguments to insert into the plotting call to let</span>
<span class="sd">            other plot attributes vary across levels of the hue variable (e.g.</span>
<span class="sd">            the markers in a scatterplot).</span>
<span class="sd">        vars : list of variable names, optional</span>
<span class="sd">            Variables within ``data`` to use, otherwise use every column with</span>
<span class="sd">            a numeric datatype.</span>
<span class="sd">        {x, y}_vars : lists of variable names, optional</span>
<span class="sd">            Variables within ``data`` to use separately for the rows and</span>
<span class="sd">            columns of the figure; i.e. to make a non-square plot.</span>
<span class="sd">        height : scalar, optional</span>
<span class="sd">            Height (in inches) of each facet.</span>
<span class="sd">        aspect : scalar, optional</span>
<span class="sd">            Aspect * height gives the width (in inches) of each facet.</span>
<span class="sd">        despine : boolean, optional</span>
<span class="sd">            Remove the top and right spines from the plots.</span>
<span class="sd">        dropna : boolean, optional</span>
<span class="sd">            Drop missing values from the data before plotting.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pairplot : Easily drawing common uses of :class:`PairGrid`.</span>
<span class="sd">        FacetGrid : Subplot grid for plotting conditional relationships.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Draw a scatterplot for each pairwise relationship:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; import seaborn as sns; sns.set()</span>
<span class="sd">            &gt;&gt;&gt; iris = sns.load_dataset(&quot;iris&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map(plt.scatter)</span>

<span class="sd">        Show a univariate distribution on the diagonal:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_diag(plt.hist)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_offdiag(plt.scatter)</span>

<span class="sd">        (It&#39;s not actually necessary to catch the return value every time,</span>
<span class="sd">        as it is the same object, but it makes it easier to deal with the</span>
<span class="sd">        doctests).</span>

<span class="sd">        Color the points using a categorical variable:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris, hue=&quot;species&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_diag(plt.hist)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_offdiag(plt.scatter)</span>
<span class="sd">            &gt;&gt;&gt; g = g.add_legend()</span>

<span class="sd">        Use a different style to show multiple histograms:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris, hue=&quot;species&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_diag(plt.hist, histtype=&quot;step&quot;, linewidth=3)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_offdiag(plt.scatter)</span>
<span class="sd">            &gt;&gt;&gt; g = g.add_legend()</span>

<span class="sd">        Plot a subset of variables</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris, vars=[&quot;sepal_length&quot;, &quot;sepal_width&quot;])</span>
<span class="sd">            &gt;&gt;&gt; g = g.map(plt.scatter)</span>

<span class="sd">        Pass additional keyword arguments to the functions</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_diag(plt.hist, edgecolor=&quot;w&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_offdiag(plt.scatter, edgecolor=&quot;w&quot;, s=40)</span>

<span class="sd">        Use different variables for the rows and columns:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris,</span>
<span class="sd">            ...                  x_vars=[&quot;sepal_length&quot;, &quot;sepal_width&quot;],</span>
<span class="sd">            ...                  y_vars=[&quot;petal_length&quot;, &quot;petal_width&quot;])</span>
<span class="sd">            &gt;&gt;&gt; g = g.map(plt.scatter)</span>

<span class="sd">        Use different functions on the upper and lower triangles:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_upper(plt.scatter)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_lower(sns.kdeplot, cmap=&quot;Blues_d&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.map_diag(sns.kdeplot, lw=3, legend=False)</span>

<span class="sd">        Use different colors and markers for each categorical level:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.PairGrid(iris, hue=&quot;species&quot;, palette=&quot;Set2&quot;,</span>
<span class="sd">            ...                  hue_kws={&quot;marker&quot;: [&quot;o&quot;, &quot;s&quot;, &quot;D&quot;]})</span>
<span class="sd">            &gt;&gt;&gt; g = g.map(plt.scatter, linewidths=1, edgecolor=&quot;w&quot;, s=40)</span>
<span class="sd">            &gt;&gt;&gt; g = g.add_legend()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Handle deprecations</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">size</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The `size` paramter has been renamed to `height`; &quot;</span>
                   <span class="s2">&quot;please update your code.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

        <span class="c1"># Sort out the variables that define the grid</span>
        <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
            <span class="n">y_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">x_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must specify `x_vars` and `y_vars`&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numeric_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_numeric_cols</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">x_vars</span> <span class="o">=</span> <span class="n">numeric_cols</span>
            <span class="n">y_vars</span> <span class="o">=</span> <span class="n">numeric_cols</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x_vars</span><span class="p">):</span>
            <span class="n">x_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_vars</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">y_vars</span><span class="p">):</span>
            <span class="n">y_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_vars</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x_vars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_vars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">square_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_vars</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_vars</span>

        <span class="c1"># Create the figure and the array of subplots</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vars</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_vars</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vars</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vars</span><span class="p">),</span>
                                 <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
                                 <span class="n">sharex</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="p">,</span>
                                 <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c1"># Save what we are going to do with the diagonal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diag_sharey</span> <span class="o">=</span> <span class="n">diag_sharey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diag_axes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Label the axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_axis_labels</span><span class="p">()</span>

        <span class="c1"># Sort out the hue variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hue_var</span> <span class="o">=</span> <span class="n">hue</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_nolegend_&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hue_vals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;_nolegend_&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                                      <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hue_names</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">categorical_order</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">hue</span><span class="p">],</span> <span class="n">hue_order</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
                <span class="c1"># Filter NA from the list of unique hue names</span>
                <span class="n">hue_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">,</span> <span class="n">hue_names</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="o">=</span> <span class="n">hue_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hue_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">hue</span><span class="p">]</span>

        <span class="c1"># Additional dict of kwarg -&gt; list of values for mapping the hue var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hue_kws</span> <span class="o">=</span> <span class="n">hue_kws</span> <span class="k">if</span> <span class="n">hue_kws</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_palette</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span> <span class="n">palette</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_legend_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Make the plot look nice</span>
        <span class="k">if</span> <span class="n">despine</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot with the same function in every subplot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable plotting function</span>
<span class="sd">            Must take x, y arrays as positional arguments and draw onto the</span>
<span class="sd">            &quot;currently active&quot; matplotlib Axes. Also needs to accept kwargs</span>
<span class="sd">            called ``color`` and  ``label``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kw_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">y_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_vars</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">x_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars</span><span class="p">):</span>
                <span class="n">hue_grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_vals</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">label_k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                    <span class="c1"># Attempt to get data for this level, allowing for empty</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">data_k</span> <span class="o">=</span> <span class="n">hue_grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">label_k</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">data_k</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                              <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

                    <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

                    <span class="c1"># Insert the other hue aesthetics if appropriate</span>
                    <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_kws</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">kw_color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">kw_color</span>
                    <span class="n">func</span><span class="p">(</span><span class="n">data_k</span><span class="p">[</span><span class="n">x_var</span><span class="p">],</span> <span class="n">data_k</span><span class="p">[</span><span class="n">y_var</span><span class="p">],</span>
                         <span class="n">label</span><span class="o">=</span><span class="n">label_k</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_clean_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kw_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_axis_labels</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">map_diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot with a univariate function on each diagonal subplot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable plotting function</span>
<span class="sd">            Must take an x array as a positional argument and draw onto the</span>
<span class="sd">            &quot;currently active&quot; matplotlib Axes. Also needs to accept kwargs</span>
<span class="sd">            called ``color`` and  ``label``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add special diagonal axes for the univariate plot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">square_grid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">diag_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">diag_axes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars</span><span class="p">,</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">diag_sharey</span><span class="p">:</span>
                    <span class="n">diag_ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">_make_twin_axes</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                                                 <span class="n">sharey</span><span class="o">=</span><span class="n">diag_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">diag_ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">_make_twin_axes</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">diag_ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
                <span class="n">diag_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diag_ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diag_axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">diag_axes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>

        <span class="c1"># Plot on each of the diagonal axes</span>
        <span class="n">fixed_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diag_axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">hue_grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_vals</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">label_k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                <span class="c1"># Attempt to get data for this level, allowing for empty</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">hue_grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">label_k</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">data_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

                <span class="k">if</span> <span class="n">fixed_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">fixed_color</span>

                <span class="n">func</span><span class="p">(</span><span class="n">data_k</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_k</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_clean_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_axis_labels</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">map_lower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot with a bivariate function on the lower diagonal subplots.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable plotting function</span>
<span class="sd">            Must take x, y arrays as positional arguments and draw onto the</span>
<span class="sd">            &quot;currently active&quot; matplotlib Axes. Also needs to accept kwargs</span>
<span class="sd">            called ``color`` and  ``label``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kw_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tril_indices_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">hue_grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_vals</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">label_k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                <span class="c1"># Attempt to get data for this level, allowing for empty</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data_k</span> <span class="o">=</span> <span class="n">hue_grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">label_k</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">data_k</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                          <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

                <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

                <span class="n">x_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">y_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="c1"># Insert the other hue aesthetics if appropriate</span>
                <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_kws</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">kw_color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">kw_color</span>
                <span class="n">func</span><span class="p">(</span><span class="n">data_k</span><span class="p">[</span><span class="n">x_var</span><span class="p">],</span> <span class="n">data_k</span><span class="p">[</span><span class="n">y_var</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label_k</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_clean_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kw_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_axis_labels</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">map_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot with a bivariate function on the upper diagonal subplots.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable plotting function</span>
<span class="sd">            Must take x, y arrays as positional arguments and draw onto the</span>
<span class="sd">            &quot;currently active&quot; matplotlib Axes. Also needs to accept kwargs</span>
<span class="sd">            called ``color`` and  ``label``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kw_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>

            <span class="n">hue_grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_vals</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">label_k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                <span class="c1"># Attempt to get data for this level, allowing for empty</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data_k</span> <span class="o">=</span> <span class="n">hue_grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">label_k</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">data_k</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                          <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

                <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

                <span class="n">x_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">y_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="c1"># Insert the other hue aesthetics if appropriate</span>
                <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_kws</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">kw_color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">kw_color</span>
                <span class="n">func</span><span class="p">(</span><span class="n">data_k</span><span class="p">[</span><span class="n">x_var</span><span class="p">],</span> <span class="n">data_k</span><span class="p">[</span><span class="n">y_var</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label_k</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_clean_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kw_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw_color</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">map_offdiag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot with a bivariate function on the off-diagonal subplots.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable plotting function</span>
<span class="sd">            Must take x, y arrays as positional arguments and draw onto the</span>
<span class="sd">            &quot;currently active&quot; matplotlib Axes. Also needs to accept kwargs</span>
<span class="sd">            called ``color`` and  ``label``.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_add_axis_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add labels to the left and bottom Axes.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_vars</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_vars</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_find_numeric_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find which variables in a DataFrame are numeric.&quot;&quot;&quot;</span>
        <span class="c1"># This can&#39;t be the best way to do this, but  I do not</span>
        <span class="c1"># know what the best way might be, so this seems ok</span>
        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                <span class="n">numeric_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">numeric_cols</span>


<span class="k">class</span> <span class="nc">JointGrid</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid for drawing a bivariate plot with marginal univariate plots.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">space</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up the grid of subplots.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x, y : strings or vectors</span>
<span class="sd">            Data or names of variables in ``data``.</span>
<span class="sd">        data : DataFrame, optional</span>
<span class="sd">            DataFrame when ``x`` and ``y`` are variable names.</span>
<span class="sd">        height : numeric</span>
<span class="sd">            Size of each side of the figure in inches (it will be square).</span>
<span class="sd">        ratio : numeric</span>
<span class="sd">            Ratio of joint axes size to marginal axes height.</span>
<span class="sd">        space : numeric, optional</span>
<span class="sd">            Space between the joint and marginal axes</span>
<span class="sd">        dropna : bool, optional</span>
<span class="sd">            If True, remove observations that are missing from `x` and `y`.</span>
<span class="sd">        {x, y}lim : two-tuples, optional</span>
<span class="sd">            Axis limits to set before plotting.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        jointplot : High-level interface for drawing bivariate plots with</span>
<span class="sd">                    several different default plot kinds.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Initialize the figure but don&#39;t draw any plots onto it:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import seaborn as sns; sns.set(style=&quot;ticks&quot;, color_codes=True)</span>
<span class="sd">            &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>

<span class="sd">        Add plots using default parameters:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot(sns.regplot, sns.distplot)</span>

<span class="sd">        Draw the join and marginal plots separately, which allows finer-level</span>
<span class="sd">        control other parameters:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_joint(plt.scatter, color=&quot;.5&quot;, edgecolor=&quot;white&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_marginals(sns.distplot, kde=False, color=&quot;.5&quot;)</span>

<span class="sd">        Draw the two marginal plots separately:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_joint(plt.scatter, color=&quot;m&quot;, edgecolor=&quot;white&quot;)</span>
<span class="sd">            &gt;&gt;&gt; _ = g.ax_marg_x.hist(tips[&quot;total_bill&quot;], color=&quot;b&quot;, alpha=.6,</span>
<span class="sd">            ...                      bins=np.arange(0, 60, 5))</span>
<span class="sd">            &gt;&gt;&gt; _ = g.ax_marg_y.hist(tips[&quot;tip&quot;], color=&quot;r&quot;, alpha=.6,</span>
<span class="sd">            ...                      orientation=&quot;horizontal&quot;,</span>
<span class="sd">            ...                      bins=np.arange(0, 12, 1))</span>

<span class="sd">        Add an annotation with a statistic summarizing the bivariate</span>
<span class="sd">        relationship:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; from scipy import stats</span>
<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_joint(plt.scatter,</span>
<span class="sd">            ...                  color=&quot;g&quot;, s=40, edgecolor=&quot;white&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_marginals(sns.distplot, kde=False, color=&quot;g&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.annotate(stats.pearsonr)</span>

<span class="sd">        Use a custom function and formatting for the annotation</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_joint(plt.scatter,</span>
<span class="sd">            ...                  color=&quot;g&quot;, s=40, edgecolor=&quot;white&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_marginals(sns.distplot, kde=False, color=&quot;g&quot;)</span>
<span class="sd">            &gt;&gt;&gt; rsquare = lambda a, b: stats.pearsonr(a, b)[0] ** 2</span>
<span class="sd">            &gt;&gt;&gt; g = g.annotate(rsquare, template=&quot;{stat}: {val:.2f}&quot;,</span>
<span class="sd">            ...                stat=&quot;$R^2$&quot;, loc=&quot;upper left&quot;, fontsize=12)</span>

<span class="sd">        Remove the space between the joint and marginal axes:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips, space=0)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_joint(sns.kdeplot, cmap=&quot;Blues_d&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_marginals(sns.kdeplot, shade=True)</span>

<span class="sd">        Draw a smaller plot with relatively larger marginal axes:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="sd">            ...                   height=5, ratio=2)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_joint(sns.kdeplot, cmap=&quot;Reds_d&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_marginals(sns.kdeplot, color=&quot;r&quot;, shade=True)</span>

<span class="sd">        Set limits on the axes:</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; g = sns.JointGrid(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="sd">            ...                   xlim=(0, 50), ylim=(0, 8))</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_joint(sns.kdeplot, cmap=&quot;Purples_d&quot;)</span>
<span class="sd">            &gt;&gt;&gt; g = g.plot_marginals(sns.kdeplot, color=&quot;m&quot;, shade=True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle deprecations</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">size</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The `size` parameter has been renamed to `height`; &quot;</span>
                   <span class="s2">&quot;pleaes update your code.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

        <span class="c1"># Set up the subplot grid</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">ratio</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">ax_joint</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax_marg_x</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax_joint</span><span class="p">)</span>
        <span class="n">ax_marg_y</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">ax_joint</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_joint</span> <span class="o">=</span> <span class="n">ax_joint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_marg_x</span> <span class="o">=</span> <span class="n">ax_marg_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_marg_y</span> <span class="o">=</span> <span class="n">ax_marg_y</span>

        <span class="c1"># Turn off tick visibility for the measure axis on the marginal plots</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_marg_x</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_marg_y</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Turn off the ticks on the density axis for the marginal plots</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_marg_x</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_majorticklines</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_marg_x</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_minorticklines</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_marg_y</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklines</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_marg_y</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_minorticklines</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_marg_x</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_marg_y</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_marg_x</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_marg_y</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Possibly extract the variables from a DataFrame</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;Could not interpret input &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c1"># Find the names of the variables</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span>
            <span class="n">ax_joint</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">name</span>
            <span class="n">ax_joint</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># Convert the x and y data to arrays for indexing and plotting</span>
        <span class="n">x_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># Possibly drop NA</span>
        <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
            <span class="n">not_na</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">x_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">y_array</span><span class="p">)</span>
            <span class="n">x_array</span> <span class="o">=</span> <span class="n">x_array</span><span class="p">[</span><span class="n">not_na</span><span class="p">]</span>
            <span class="n">y_array</span> <span class="o">=</span> <span class="n">y_array</span><span class="p">[</span><span class="n">not_na</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y_array</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax_joint</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax_joint</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

        <span class="c1"># Make the grid look nice</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_marg_x</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_marg_y</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="n">space</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">space</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_func</span><span class="p">,</span> <span class="n">marginal_func</span><span class="p">,</span> <span class="n">annot_func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shortcut to draw the full plot.</span>

<span class="sd">        Use `plot_joint` and `plot_marginals` directly for more control.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        joint_func, marginal_func: callables</span>
<span class="sd">            Functions to draw the bivariate and univariate plots.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : JointGrid instance</span>
<span class="sd">            Returns `self`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_marginals</span><span class="p">(</span><span class="n">marginal_func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">joint_func</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">annot_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">annot_func</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">plot_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw a bivariate plot of `x` and `y`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : plotting callable</span>
<span class="sd">            This must take two 1d arrays of data as the first two</span>
<span class="sd">            positional arguments, and it must plot on the &quot;current&quot; axes.</span>
<span class="sd">        kwargs : key, value mappings</span>
<span class="sd">            Keyword argument are passed to the plotting function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : JointGrid instance</span>
<span class="sd">            Returns `self`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_joint</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">plot_marginals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw univariate plots for `x` and `y` separately.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : plotting callable</span>
<span class="sd">            This must take a 1d array of data as the first positional</span>
<span class="sd">            argument, it must plot on the &quot;current&quot; axes, and it must</span>
<span class="sd">            accept a &quot;vertical&quot; keyword argument to orient the measure</span>
<span class="sd">            dimension of the plot vertically.</span>
<span class="sd">        kwargs : key, value mappings</span>
<span class="sd">            Keyword argument are passed to the plotting function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : JointGrid instance</span>
<span class="sd">            Returns `self`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;vertical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_marg_x</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;vertical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_marg_y</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Annotate the plot with a statistic about the relationship.</span>

<span class="sd">        *Deprecated and will be removed in a future version*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Statistical function that maps the x, y vectors either to (val, p)</span>
<span class="sd">            or to val.</span>
<span class="sd">        template : string format template, optional</span>
<span class="sd">            The template must have the format keys &quot;stat&quot; and &quot;val&quot;;</span>
<span class="sd">            if `func` returns a p value, it should also have the key &quot;p&quot;.</span>
<span class="sd">        stat : string, optional</span>
<span class="sd">            Name to use for the statistic in the annotation, by default it</span>
<span class="sd">            uses the name of `func`.</span>
<span class="sd">        loc : string or int, optional</span>
<span class="sd">            Matplotlib legend location code; used to place the annotation.</span>
<span class="sd">        kwargs : key, value mappings</span>
<span class="sd">            Other keyword arguments are passed to `ax.legend`, which formats</span>
<span class="sd">            the annotation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : JointGrid instance.</span>
<span class="sd">            Returns `self`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;JointGrid annotation is deprecated and will be removed &quot;</span>
               <span class="s2">&quot;in a future release.&quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

        <span class="n">default_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{stat}</span><span class="s2"> = </span><span class="si">{val:.2g}</span><span class="s2">; p = </span><span class="si">{p:.2g}</span><span class="s2">&quot;</span>

        <span class="c1"># Call the function and determine the form of the return value(s)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">out</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">out</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">default_template</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">default_template</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>

        <span class="c1"># Set the default template</span>
        <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">default_template</span>

        <span class="c1"># Default to name of the function</span>
        <span class="k">if</span> <span class="n">stat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># Format the annotation</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># Draw an invisible plot and use the legend to draw the annotation</span>
        <span class="c1"># This is a bit of a hack, but `loc=best` works nicely and is not</span>
        <span class="c1"># easily abstracted.</span>
        <span class="n">phantom</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">phantom</span><span class="p">],</span> <span class="p">[</span><span class="n">annotation</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">phantom</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">set_axis_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the axis labels on the bivariate axes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xlabel, ylabel : strings</span>
<span class="sd">            Label names for the x and y variables.</span>
<span class="sd">        kwargs : key, value mappings</span>
<span class="sd">            Other keyword arguments are passed to the set_xlabel or</span>
<span class="sd">            set_ylabel.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : JointGrid instance</span>
<span class="sd">            returns `self`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">savefig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap figure.savefig defaulting to tight bounding box.&quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;bbox_inches&quot;</span><span class="p">,</span> <span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="pairplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.pairplot">[docs]</a><span class="k">def</span> <span class="nf">pairplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="nb">vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span> <span class="n">diag_kind</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">height</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">plot_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">diag_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot pairwise relationships in a dataset.</span>

<span class="sd">    By default, this function will create a grid of Axes such that each</span>
<span class="sd">    variable in ``data`` will by shared in the y-axis across a single row and</span>
<span class="sd">    in the x-axis across a single column. The diagonal Axes are treated</span>
<span class="sd">    differently, drawing a plot to show the univariate distribution of the data</span>
<span class="sd">    for the variable in that column.</span>

<span class="sd">    It is also possible to show a subset of variables or plot different</span>
<span class="sd">    variables on the rows and columns.</span>

<span class="sd">    This is a high-level interface for :class:`PairGrid` that is intended to</span>
<span class="sd">    make it easy to draw a few common styles. You should use :class:`PairGrid`</span>
<span class="sd">    directly if you need more flexibility.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : DataFrame</span>
<span class="sd">        Tidy (long-form) dataframe where each column is a variable and</span>
<span class="sd">        each row is an observation.</span>
<span class="sd">    hue : string (variable name), optional</span>
<span class="sd">        Variable in ``data`` to map plot aspects to different colors.</span>
<span class="sd">    hue_order : list of strings</span>
<span class="sd">        Order for the levels of the hue variable in the palette</span>
<span class="sd">    palette : dict or seaborn color palette</span>
<span class="sd">        Set of colors for mapping the ``hue`` variable. If a dict, keys</span>
<span class="sd">        should be values  in the ``hue`` variable.</span>
<span class="sd">    vars : list of variable names, optional</span>
<span class="sd">        Variables within ``data`` to use, otherwise use every column with</span>
<span class="sd">        a numeric datatype.</span>
<span class="sd">    {x, y}_vars : lists of variable names, optional</span>
<span class="sd">        Variables within ``data`` to use separately for the rows and</span>
<span class="sd">        columns of the figure; i.e. to make a non-square plot.</span>
<span class="sd">    kind : {&#39;scatter&#39;, &#39;reg&#39;}, optional</span>
<span class="sd">        Kind of plot for the non-identity relationships.</span>
<span class="sd">    diag_kind : {&#39;auto&#39;, &#39;hist&#39;, &#39;kde&#39;}, optional</span>
<span class="sd">        Kind of plot for the diagonal subplots. The default depends on whether</span>
<span class="sd">        ``&quot;hue&quot;`` is used or not.</span>
<span class="sd">    markers : single matplotlib marker code or list, optional</span>
<span class="sd">        Either the marker to use for all datapoints or a list of markers with</span>
<span class="sd">        a length the same as the number of levels in the hue variable so that</span>
<span class="sd">        differently colored points will also have different scatterplot</span>
<span class="sd">        markers.</span>
<span class="sd">    height : scalar, optional</span>
<span class="sd">        Height (in inches) of each facet.</span>
<span class="sd">    aspect : scalar, optional</span>
<span class="sd">        Aspect * height gives the width (in inches) of each facet.</span>
<span class="sd">    dropna : boolean, optional</span>
<span class="sd">        Drop missing values from the data before plotting.</span>
<span class="sd">    {plot, diag, grid}_kws : dicts, optional</span>
<span class="sd">        Dictionaries of keyword arguments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    grid : PairGrid</span>
<span class="sd">        Returns the underlying ``PairGrid`` instance for further tweaking.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    PairGrid : Subplot grid for more flexible plotting of pairwise</span>
<span class="sd">               relationships.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Draw scatterplots for joint relationships and histograms for univariate</span>
<span class="sd">    distributions:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; import seaborn as sns; sns.set(style=&quot;ticks&quot;, color_codes=True)</span>
<span class="sd">        &gt;&gt;&gt; iris = sns.load_dataset(&quot;iris&quot;)</span>
<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris)</span>

<span class="sd">    Show different levels of a categorical variable by the color of plot</span>
<span class="sd">    elements:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris, hue=&quot;species&quot;)</span>

<span class="sd">    Use a different color palette:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris, hue=&quot;species&quot;, palette=&quot;husl&quot;)</span>

<span class="sd">    Use different markers for each level of the hue variable:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris, hue=&quot;species&quot;, markers=[&quot;o&quot;, &quot;s&quot;, &quot;D&quot;])</span>

<span class="sd">    Plot a subset of variables:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris, vars=[&quot;sepal_width&quot;, &quot;sepal_length&quot;])</span>

<span class="sd">    Draw larger plots:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris, height=3,</span>
<span class="sd">        ...                  vars=[&quot;sepal_width&quot;, &quot;sepal_length&quot;])</span>

<span class="sd">    Plot different variables in the rows and columns:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris,</span>
<span class="sd">        ...                  x_vars=[&quot;sepal_width&quot;, &quot;sepal_length&quot;],</span>
<span class="sd">        ...                  y_vars=[&quot;petal_width&quot;, &quot;petal_length&quot;])</span>

<span class="sd">    Use kernel density estimates for univariate plots:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris, diag_kind=&quot;kde&quot;)</span>

<span class="sd">    Fit linear regression models to the scatter plots:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris, kind=&quot;reg&quot;)</span>

<span class="sd">    Pass keyword arguments down to the underlying functions (it may be easier</span>
<span class="sd">    to use :class:`PairGrid` directly):</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.pairplot(iris, diag_kind=&quot;kde&quot;, markers=&quot;+&quot;,</span>
<span class="sd">        ...                  plot_kws=dict(s=50, edgecolor=&quot;b&quot;, linewidth=1),</span>
<span class="sd">        ...                  diag_kws=dict(shade=True))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Handle deprecations</span>
    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The `size` parameter has been renamed to `height`; &quot;</span>
               <span class="s2">&quot;pleaes update your code.&quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;data&#39; must be pandas DataFrame object, not: </span><span class="si">{typefound}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">typefound</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">plot_kws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_kws</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">diag_kws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">diag_kws</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">grid_kws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grid_kws</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Set up the PairGrid</span>
    <span class="n">diag_sharey</span> <span class="o">=</span> <span class="n">diag_kind</span> <span class="o">==</span> <span class="s2">&quot;hist&quot;</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">PairGrid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x_vars</span><span class="o">=</span><span class="n">x_vars</span><span class="p">,</span> <span class="n">y_vars</span><span class="o">=</span><span class="n">y_vars</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">hue</span><span class="p">,</span>
                    <span class="n">hue_order</span><span class="o">=</span><span class="n">hue_order</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
                    <span class="n">diag_sharey</span><span class="o">=</span><span class="n">diag_sharey</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span> <span class="o">**</span><span class="n">grid_kws</span><span class="p">)</span>

    <span class="c1"># Add the markers here as PairGrid has figured out how many levels of the</span>
    <span class="c1"># hue variable are needed and we don&#39;t want to duplicate that process</span>
    <span class="k">if</span> <span class="n">markers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_markers</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_markers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="n">markers</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_markers</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_markers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;markers must be a singleton or a list of &quot;</span>
                              <span class="s2">&quot;markers for each level of the hue variable&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">hue_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="n">markers</span><span class="p">}</span>

    <span class="c1"># Maybe plot on the diagonal</span>
    <span class="k">if</span> <span class="n">diag_kind</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
        <span class="n">diag_kind</span> <span class="o">=</span> <span class="s2">&quot;hist&quot;</span> <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;kde&quot;</span>

    <span class="n">diag_kws</span> <span class="o">=</span> <span class="n">diag_kws</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">square_grid</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">diag_kind</span> <span class="o">==</span> <span class="s2">&quot;hist&quot;</span><span class="p">:</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="o">**</span><span class="n">diag_kws</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">diag_kind</span> <span class="o">==</span> <span class="s2">&quot;kde&quot;</span><span class="p">:</span>
            <span class="n">diag_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;shade&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">diag_kws</span><span class="p">[</span><span class="s2">&quot;legend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">kdeplot</span><span class="p">,</span> <span class="o">**</span><span class="n">diag_kws</span><span class="p">)</span>

    <span class="c1"># Maybe plot on the off-diagonals</span>
    <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">square_grid</span> <span class="ow">and</span> <span class="n">diag_kind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">map_offdiag</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">map</span>

    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;scatter&quot;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.relational</span> <span class="k">import</span> <span class="n">scatterplot</span>  <span class="c1"># Avoid circular import</span>
        <span class="n">plotter</span><span class="p">(</span><span class="n">scatterplot</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kws</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;reg&quot;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.regression</span> <span class="k">import</span> <span class="n">regplot</span>  <span class="c1"># Avoid circular import</span>
        <span class="n">plotter</span><span class="p">(</span><span class="n">regplot</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kws</span><span class="p">)</span>

    <span class="c1"># Add a legend</span>
    <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">grid</span></div>


<div class="viewcode-block" id="jointplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.jointplot">[docs]</a><span class="k">def</span> <span class="nf">jointplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span> <span class="n">stat_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">space</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">joint_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marginal_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draw a plot of two variables with bivariate and univariate graphs.</span>

<span class="sd">    This function provides a convenient interface to the :class:`JointGrid`</span>
<span class="sd">    class, with several canned plot kinds. This is intended to be a fairly</span>
<span class="sd">    lightweight wrapper; if you need more flexibility, you should use</span>
<span class="sd">    :class:`JointGrid` directly.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x, y : strings or vectors</span>
<span class="sd">        Data or names of variables in ``data``.</span>
<span class="sd">    data : DataFrame, optional</span>
<span class="sd">        DataFrame when ``x`` and ``y`` are variable names.</span>
<span class="sd">    kind : { &quot;scatter&quot; | &quot;reg&quot; | &quot;resid&quot; | &quot;kde&quot; | &quot;hex&quot; }, optional</span>
<span class="sd">        Kind of plot to draw.</span>
<span class="sd">    stat_func : callable or None, optional</span>
<span class="sd">        *Deprecated*</span>
<span class="sd">    color : matplotlib color, optional</span>
<span class="sd">        Color used for the plot elements.</span>
<span class="sd">    height : numeric, optional</span>
<span class="sd">        Size of the figure (it will be square).</span>
<span class="sd">    ratio : numeric, optional</span>
<span class="sd">        Ratio of joint axes height to marginal axes height.</span>
<span class="sd">    space : numeric, optional</span>
<span class="sd">        Space between the joint and marginal axes</span>
<span class="sd">    dropna : bool, optional</span>
<span class="sd">        If True, remove observations that are missing from ``x`` and ``y``.</span>
<span class="sd">    {x, y}lim : two-tuples, optional</span>
<span class="sd">        Axis limits to set before plotting.</span>
<span class="sd">    {joint, marginal, annot}_kws : dicts, optional</span>
<span class="sd">        Additional keyword arguments for the plot components.</span>
<span class="sd">    kwargs : key, value pairings</span>
<span class="sd">        Additional keyword arguments are passed to the function used to</span>
<span class="sd">        draw the plot on the joint Axes, superseding items in the</span>
<span class="sd">        ``joint_kws`` dictionary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    grid : :class:`JointGrid`</span>
<span class="sd">        :class:`JointGrid` object with the plot on it.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    JointGrid : The Grid class used for drawing this plot. Use it directly if</span>
<span class="sd">                you need more flexibility.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Draw a scatterplot with marginal histograms:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np, pandas as pd; np.random.seed(0)</span>
<span class="sd">        &gt;&gt;&gt; import seaborn as sns; sns.set(style=&quot;white&quot;, color_codes=True)</span>
<span class="sd">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="sd">        &gt;&gt;&gt; g = sns.jointplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>

<span class="sd">    Add regression and kernel density fits:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.jointplot(&quot;total_bill&quot;, &quot;tip&quot;, data=tips, kind=&quot;reg&quot;)</span>

<span class="sd">    Replace the scatterplot with a joint histogram using hexagonal bins:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.jointplot(&quot;total_bill&quot;, &quot;tip&quot;, data=tips, kind=&quot;hex&quot;)</span>

<span class="sd">    Replace the scatterplots and histograms with density estimates and align</span>
<span class="sd">    the marginal Axes tightly with the joint Axes:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; iris = sns.load_dataset(&quot;iris&quot;)</span>
<span class="sd">        &gt;&gt;&gt; g = sns.jointplot(&quot;sepal_width&quot;, &quot;petal_length&quot;, data=iris,</span>
<span class="sd">        ...                   kind=&quot;kde&quot;, space=0, color=&quot;g&quot;)</span>

<span class="sd">    Draw a scatterplot, then add a joint density estimate:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = (sns.jointplot(&quot;sepal_length&quot;, &quot;sepal_width&quot;,</span>
<span class="sd">        ...                    data=iris, color=&quot;k&quot;)</span>
<span class="sd">        ...         .plot_joint(sns.kdeplot, zorder=0, n_levels=6))</span>

<span class="sd">    Pass vectors in directly without using Pandas, then name the axes:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; x, y = np.random.randn(2, 300)</span>
<span class="sd">        &gt;&gt;&gt; g = (sns.jointplot(x, y, kind=&quot;hex&quot;)</span>
<span class="sd">        ...         .set_axis_labels(&quot;x&quot;, &quot;y&quot;))</span>

<span class="sd">    Draw a smaller figure with more space devoted to the marginal plots:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.jointplot(&quot;total_bill&quot;, &quot;tip&quot;, data=tips,</span>
<span class="sd">        ...                   height=5, ratio=3, color=&quot;g&quot;)</span>

<span class="sd">    Pass keyword arguments down to the underlying plots:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        &gt;&gt;&gt; g = sns.jointplot(&quot;petal_length&quot;, &quot;sepal_length&quot;, data=iris,</span>
<span class="sd">        ...                   marginal_kws=dict(bins=15, rug=True),</span>
<span class="sd">        ...                   annot_kws=dict(stat=&quot;r&quot;),</span>
<span class="sd">        ...                   s=40, edgecolor=&quot;w&quot;, linewidth=1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Handle deprecations</span>
    <span class="k">if</span> <span class="s2">&quot;size&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The `size` paramter has been renamed to `height`; &quot;</span>
               <span class="s2">&quot;please update your code.&quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="c1"># Set up empty default kwarg dicts</span>
    <span class="k">if</span> <span class="n">joint_kws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">joint_kws</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">joint_kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">marginal_kws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">marginal_kws</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">annot_kws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">annot_kws</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Make a colormap based off the plot color</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">color_rgb</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">colorConverter</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">set_hls_values</span><span class="p">(</span><span class="n">color_rgb</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>  <span class="c1"># noqa</span>
              <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)]</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">blend_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Initialize the JointGrid object</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">JointGrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span>
                     <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">,</span>
                     <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>

    <span class="c1"># Plot the data using the grid</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;scatter&quot;</span><span class="p">:</span>

        <span class="n">joint_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="o">**</span><span class="n">joint_kws</span><span class="p">)</span>

        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;kde&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_marginals</span><span class="p">(</span><span class="n">distplot</span><span class="p">,</span> <span class="o">**</span><span class="n">marginal_kws</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">kind</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">):</span>

        <span class="n">x_bins</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">_freedman_diaconis_bins</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">y_bins</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">_freedman_diaconis_bins</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">gridsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x_bins</span><span class="p">,</span> <span class="n">y_bins</span><span class="p">]))</span>

        <span class="n">joint_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;gridsize&quot;</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">)</span>
        <span class="n">joint_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hexbin</span><span class="p">,</span> <span class="o">**</span><span class="n">joint_kws</span><span class="p">)</span>

        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;kde&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_marginals</span><span class="p">(</span><span class="n">distplot</span><span class="p">,</span> <span class="o">**</span><span class="n">marginal_kws</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">kind</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;kde&quot;</span><span class="p">):</span>

        <span class="n">joint_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;shade&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">joint_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">kdeplot</span><span class="p">,</span> <span class="o">**</span><span class="n">joint_kws</span><span class="p">)</span>

        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;shade&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_marginals</span><span class="p">(</span><span class="n">kdeplot</span><span class="p">,</span> <span class="o">**</span><span class="n">marginal_kws</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">kind</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;reg&quot;</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">.regression</span> <span class="k">import</span> <span class="n">regplot</span>

        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_marginals</span><span class="p">(</span><span class="n">distplot</span><span class="p">,</span> <span class="o">**</span><span class="n">marginal_kws</span><span class="p">)</span>

        <span class="n">joint_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">regplot</span><span class="p">,</span> <span class="o">**</span><span class="n">joint_kws</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">kind</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;resid&quot;</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">.regression</span> <span class="k">import</span> <span class="n">residplot</span>

        <span class="n">joint_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">residplot</span><span class="p">,</span> <span class="o">**</span><span class="n">joint_kws</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_offsets</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">marginal_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;kde&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">distplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">ax_marg_x</span><span class="p">,</span> <span class="o">**</span><span class="n">marginal_kws</span><span class="p">)</span>
        <span class="n">distplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">ax_marg_y</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">marginal_kws</span><span class="p">)</span>
        <span class="n">stat_func</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;kind must be either &#39;scatter&#39;, &#39;reg&#39;, &#39;resid&#39;, &#39;kde&#39;, or &#39;hex&#39;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">stat_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">stat_func</span><span class="p">,</span> <span class="o">**</span><span class="n">annot_kws</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">grid</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, M. Giantomassi and the AbiPy group.<br/>
      Last updated on Oct 18, 2019.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>