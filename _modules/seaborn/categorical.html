<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>seaborn.categorical &#8212; abipy 0.7.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my_style.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          abipy</a>
        <span class="navbar-text navbar-version pull-left"><b>0.7.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Getting AbiPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zzbiblio.html">Bibliography</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/index.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery/index.html">AbiPy Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../postprocessing_howto.html">Post-processing How-To</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/taskmanager.html">TaskManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/manager_examples.html">Manager Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../flow_gallery/index.html">Flow Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../flows_howto.html">Flows How-To</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coding_guide.html">Coding guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Documenting AbiPy</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for seaborn.categorical</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="k">import</span> <span class="n">dedent</span>
<span class="kn">import</span> <span class="nn">colorsys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="k">import</span> <span class="n">PatchCollection</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">Patches</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">.external.six</span> <span class="k">import</span> <span class="n">string_types</span>
<span class="kn">from</span> <span class="nn">.external.six.moves</span> <span class="k">import</span> <span class="nb">range</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">iqr</span><span class="p">,</span> <span class="n">categorical_order</span><span class="p">,</span> <span class="n">remove_na</span>
<span class="kn">from</span> <span class="nn">.algorithms</span> <span class="k">import</span> <span class="n">bootstrap</span>
<span class="kn">from</span> <span class="nn">.palettes</span> <span class="k">import</span> <span class="n">color_palette</span><span class="p">,</span> <span class="n">husl_palette</span><span class="p">,</span> <span class="n">light_palette</span><span class="p">,</span> <span class="n">dark_palette</span>
<span class="kn">from</span> <span class="nn">.axisgrid</span> <span class="k">import</span> <span class="n">FacetGrid</span><span class="p">,</span> <span class="n">_facet_docs</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;catplot&quot;</span><span class="p">,</span> <span class="s2">&quot;factorplot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stripplot&quot;</span><span class="p">,</span> <span class="s2">&quot;swarmplot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;boxplot&quot;</span><span class="p">,</span> <span class="s2">&quot;violinplot&quot;</span><span class="p">,</span> <span class="s2">&quot;boxenplot&quot;</span><span class="p">,</span> <span class="s2">&quot;lvplot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pointplot&quot;</span><span class="p">,</span> <span class="s2">&quot;barplot&quot;</span><span class="p">,</span> <span class="s2">&quot;countplot&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">class</span> <span class="nc">_CategoricalPlotter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">width</span> <span class="o">=</span> <span class="o">.</span><span class="mi">8</span>
    <span class="n">default_palette</span> <span class="o">=</span> <span class="s2">&quot;light&quot;</span>

    <span class="k">def</span> <span class="nf">establish_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert input specification into a common representation.&quot;&quot;&quot;</span>
        <span class="c1"># Option 1:</span>
        <span class="c1"># We are plotting a wide-form dataset</span>
        <span class="c1"># -----------------------------------</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Do a sanity check on the inputs</span>
            <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Cannot use `hue` without `x` or `y`&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

            <span class="c1"># No hue grouping with wide inputs</span>
            <span class="n">plot_hues</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hue_title</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hue_names</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># No statistical units with wide inputs</span>
            <span class="n">plot_units</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># We also won&#39;t get a axes labels here</span>
            <span class="n">value_label</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">group_label</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Option 1a:</span>
            <span class="c1"># The input data is a Pandas DataFrame</span>
            <span class="c1"># ------------------------------------</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>

                <span class="c1"># Order the data correctly</span>
                <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="c1"># Reduce to just numeric columns</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                            <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="n">plot_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
                <span class="n">group_names</span> <span class="o">=</span> <span class="n">order</span>
                <span class="n">group_label</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>

                <span class="c1"># Convert to a list of arrays, the common representation</span>
                <span class="n">iter_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
                <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">iter_data</span><span class="p">]</span>

            <span class="c1"># Option 1b:</span>
            <span class="c1"># The input data is an array or list</span>
            <span class="c1"># ----------------------------------</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># We can&#39;t reorder the data</span>
                <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Input data must be a pandas object to reorder&quot;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

                <span class="c1"># The input data is an array</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">plot_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">nr</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
                        <span class="k">if</span> <span class="n">nr</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">)]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Input `data` can have no &quot;</span>
                                 <span class="s2">&quot;more than 2 dimensions&quot;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

                <span class="c1"># Check if `data` is None to let us bail out here (for testing)</span>
                <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[[]]</span>

                <span class="c1"># The input data is a flat list</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>

                <span class="c1"># The input data is a nested list</span>
                <span class="c1"># This will catch some things that might fail later</span>
                <span class="c1"># but exhaustive checks are hard</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_data</span> <span class="o">=</span> <span class="n">data</span>

                <span class="c1"># Convert to a list of arrays, the common representation</span>
                <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">plot_data</span><span class="p">]</span>

                <span class="c1"># The group names will just be numeric indices</span>
                <span class="n">group_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">plot_data</span><span class="p">))))</span>

            <span class="c1"># Figure out the plotting orientation</span>
            <span class="n">orient</span> <span class="o">=</span> <span class="s2">&quot;h&quot;</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">orient</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;v&quot;</span>

        <span class="c1"># Option 2:</span>
        <span class="c1"># We are plotting a long-form dataset</span>
        <span class="c1"># -----------------------------------</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># See if we need to get variables from `data`</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">hue</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="n">hue</span><span class="p">)</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>

            <span class="c1"># Validate the inputs</span>
            <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">units</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                    <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;Could not interpret input &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

            <span class="c1"># Figure out the plotting orientation</span>
            <span class="n">orient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infer_orient</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">orient</span><span class="p">)</span>

            <span class="c1"># Option 2a:</span>
            <span class="c1"># We are plotting a single set of data</span>
            <span class="c1"># ------------------------------------</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Determine where the data are</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">y</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span>

                <span class="c1"># Put them into the common representation</span>
                <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)]</span>

                <span class="c1"># Get a label for the value axis</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
                    <span class="n">value_label</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_label</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># This plot will not have group labels or hue nesting</span>
                <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">group_label</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">group_names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">plot_hues</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">hue_names</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">hue_title</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">plot_units</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Option 2b:</span>
            <span class="c1"># We are grouping the data values by another variable</span>
            <span class="c1"># ---------------------------------------------------</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Determine which role each variable will play</span>
                <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
                    <span class="n">vals</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vals</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

                <span class="c1"># Get the categorical axis label</span>
                <span class="n">group_label</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
                    <span class="n">group_label</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">name</span>

                <span class="c1"># Get the order on the categorical axis</span>
                <span class="n">group_names</span> <span class="o">=</span> <span class="n">categorical_order</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>

                <span class="c1"># Group the numeric data</span>
                <span class="n">plot_data</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_longform</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span>
                                                              <span class="n">group_names</span><span class="p">)</span>

                <span class="c1"># Now handle the hue levels for nested ordering</span>
                <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">plot_hues</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">hue_title</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">hue_names</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="c1"># Get the order of the hue levels</span>
                    <span class="n">hue_names</span> <span class="o">=</span> <span class="n">categorical_order</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">)</span>

                    <span class="c1"># Group the hue data</span>
                    <span class="n">plot_hues</span><span class="p">,</span> <span class="n">hue_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_longform</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span>
                                                                <span class="n">group_names</span><span class="p">)</span>

                <span class="c1"># Now handle the units for nested observations</span>
                <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">plot_units</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_units</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_longform</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span>
                                                         <span class="n">group_names</span><span class="p">)</span>

        <span class="c1"># Assign object attributes</span>
        <span class="c1"># ------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">=</span> <span class="n">orient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_label</span> <span class="o">=</span> <span class="n">group_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_label</span> <span class="o">=</span> <span class="n">value_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span> <span class="o">=</span> <span class="n">group_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="o">=</span> <span class="n">plot_hues</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hue_title</span> <span class="o">=</span> <span class="n">hue_title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="o">=</span> <span class="n">hue_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span> <span class="o">=</span> <span class="n">plot_units</span>

    <span class="k">def</span> <span class="nf">_group_longform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">grouper</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Group a long-form variable by another with correct order.&quot;&quot;&quot;</span>
        <span class="c1"># Ensure that the groupby will work</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

        <span class="c1"># Group the val data</span>
        <span class="n">grouped_vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouper</span><span class="p">)</span>
        <span class="n">out_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">g_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grouped_vals</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">g_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_vals</span><span class="p">)</span>

        <span class="c1"># Get the vals axis label</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="n">out_data</span><span class="p">,</span> <span class="n">label</span>

    <span class="k">def</span> <span class="nf">establish_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a list of colors for the main component of the plots.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span>

        <span class="c1"># Determine the main colors</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">palette</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Determine whether the current palette will have enough values</span>
            <span class="c1"># If not, we&#39;ll default to the husl palette so each is distinct</span>
            <span class="n">current_palette</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_color_cycle</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">n_colors</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_palette</span><span class="p">):</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">n_colors</span><span class="o">=</span><span class="n">n_colors</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">husl_palette</span><span class="p">(</span><span class="n">n_colors</span><span class="p">,</span> <span class="n">l</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># noqa</span>

        <span class="k">elif</span> <span class="n">palette</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># When passing a specific color, the interpretation depends</span>
            <span class="c1"># on whether there is a hue variable or not.</span>
            <span class="c1"># If so, we will make a blend palette so that the different</span>
            <span class="c1"># levels have some amount of variation.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_colors</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_palette</span> <span class="o">==</span> <span class="s2">&quot;light&quot;</span><span class="p">:</span>
                    <span class="n">colors</span> <span class="o">=</span> <span class="n">light_palette</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_palette</span> <span class="o">==</span> <span class="s2">&quot;dark&quot;</span><span class="p">:</span>
                    <span class="n">colors</span> <span class="o">=</span> <span class="n">dark_palette</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No default palette specified&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Let `palette` be a dict mapping level to color</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">palette</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_names</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span>
                <span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="n">palette</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">]</span>

            <span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">palette</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>

        <span class="c1"># Desaturate a bit because these are patches</span>
        <span class="k">if</span> <span class="n">saturation</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">desat</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>

        <span class="c1"># Conver the colors to a common representations</span>
        <span class="n">rgb_colors</span> <span class="o">=</span> <span class="n">color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

        <span class="c1"># Determine the gray color to use for the lines framing the plot</span>
        <span class="n">light_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">colorsys</span><span class="o">.</span><span class="n">rgb_to_hls</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rgb_colors</span><span class="p">]</span>
        <span class="n">lum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">light_vals</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">6</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">((</span><span class="n">lum</span><span class="p">,</span> <span class="n">lum</span><span class="p">,</span> <span class="n">lum</span><span class="p">))</span>

        <span class="c1"># Assign object attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">rgb_colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gray</span> <span class="o">=</span> <span class="n">gray</span>

    <span class="k">def</span> <span class="nf">infer_orient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine how the plot should be oriented based on the data.&quot;&quot;&quot;</span>
        <span class="n">orient</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">orient</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">is_categorical</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Correct way, but does not exist in older Pandas</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># Also works, but feels hackier</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span>

        <span class="k">def</span> <span class="nf">is_not_numeric</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">no_numeric</span> <span class="o">=</span> <span class="s2">&quot;Neither the `x` nor `y` variable appears to be numeric.&quot;</span>

        <span class="k">if</span> <span class="n">orient</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;v&quot;</span>
        <span class="k">elif</span> <span class="n">orient</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;h&quot;</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;v&quot;</span>
        <span class="k">elif</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;h&quot;</span>
        <span class="k">elif</span> <span class="n">is_categorical</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_categorical</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">no_numeric</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;h&quot;</span>
        <span class="k">elif</span> <span class="n">is_not_numeric</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_not_numeric</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">no_numeric</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;h&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;v&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hue_offsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A list of center positions for plots when hue nesting is used.&quot;&quot;&quot;</span>
        <span class="n">n_levels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span><span class="p">:</span>
            <span class="n">each_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">n_levels</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">each_width</span><span class="p">,</span> <span class="n">n_levels</span><span class="p">)</span>
            <span class="n">offsets</span> <span class="o">-=</span> <span class="n">offsets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_levels</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">offsets</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nested_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A float with the width of plot elements when hue nesting is used.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">98</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">return</span> <span class="n">width</span>

    <span class="k">def</span> <span class="nf">annotate_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add descriptive labels to an Axes object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_label</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">)</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">)</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">leg</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_title</span><span class="p">)</span>

                <span class="c1"># Set the title size a roundabout way to maintain</span>
                <span class="c1"># compatibility with matplotlib 1.1</span>
                <span class="c1"># TODO no longer needed</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">title_size</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelsize&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">85</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># labelsize is something like &quot;large&quot;</span>
                    <span class="n">title_size</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelsize&quot;</span><span class="p">]</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">title_size</span><span class="p">)</span>
                <span class="n">leg</span><span class="o">.</span><span class="n">_legend_title_box</span><span class="o">.</span><span class="n">_text</span><span class="o">.</span><span class="n">set_font_properties</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_legend_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a dummy patch object so we can get legend data.&quot;&quot;&quot;</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                             <span class="n">edgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                             <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_BoxPlotter</span><span class="p">(</span><span class="n">_CategoricalPlotter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                 <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span>
                 <span class="n">width</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">fliersize</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_colors</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span> <span class="o">=</span> <span class="n">dodge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fliersize</span> <span class="o">=</span> <span class="n">fliersize</span>

        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span>

    <span class="k">def</span> <span class="nf">draw_boxplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use matplotlib to draw a boxplot on an Axes.&quot;&quot;&quot;</span>
        <span class="n">vert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span>

        <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="s2">&quot;whisker&quot;</span><span class="p">,</span> <span class="s2">&quot;cap&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="s2">&quot;flier&quot;</span><span class="p">]:</span>
            <span class="n">props</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">obj</span> <span class="o">+</span> <span class="s2">&quot;props&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Handle case where there is data at this level</span>
                <span class="k">if</span> <span class="n">group_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Draw a single box or a set of boxes</span>
                <span class="c1"># with a single level of grouping</span>
                <span class="n">box_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span>

                <span class="c1"># Handle case where there is no non-null data</span>
                <span class="k">if</span> <span class="n">box_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">artist_dict</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">box_data</span><span class="p">,</span>
                                         <span class="n">vert</span><span class="o">=</span><span class="n">vert</span><span class="p">,</span>
                                         <span class="n">patch_artist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                         <span class="n">widths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                                         <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restyle_boxplot</span><span class="p">(</span><span class="n">artist_dict</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Draw nested groups of boxes</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_offsets</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                    <span class="c1"># Add a legend for this hue level</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">hue_level</span><span class="p">)</span>

                    <span class="c1"># Handle case where there is data at this level</span>
                    <span class="k">if</span> <span class="n">group_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">hue_level</span>
                    <span class="n">box_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">])</span>

                    <span class="c1"># Handle case where there is no non-null data</span>
                    <span class="k">if</span> <span class="n">box_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">center</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">artist_dict</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">box_data</span><span class="p">,</span>
                                             <span class="n">vert</span><span class="o">=</span><span class="n">vert</span><span class="p">,</span>
                                             <span class="n">patch_artist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="n">center</span><span class="p">],</span>
                                             <span class="n">widths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nested_width</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restyle_boxplot</span><span class="p">(</span><span class="n">artist_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">props</span><span class="p">)</span>
                    <span class="c1"># Add legend data, but just for one set of boxes</span>

    <span class="k">def</span> <span class="nf">restyle_boxplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artist_dict</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Take a drawn matplotlib boxplot and make it look nice.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">artist_dict</span><span class="p">[</span><span class="s2">&quot;boxes&quot;</span><span class="p">]:</span>
            <span class="n">box</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span>
                            <span class="n">edgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">))</span>
            <span class="n">box</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;box&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">whisk</span> <span class="ow">in</span> <span class="n">artist_dict</span><span class="p">[</span><span class="s2">&quot;whiskers&quot;</span><span class="p">]:</span>
            <span class="n">whisk</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>
            <span class="n">whisk</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;whisker&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">cap</span> <span class="ow">in</span> <span class="n">artist_dict</span><span class="p">[</span><span class="s2">&quot;caps&quot;</span><span class="p">]:</span>
            <span class="n">cap</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">))</span>
            <span class="n">cap</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;cap&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">med</span> <span class="ow">in</span> <span class="n">artist_dict</span><span class="p">[</span><span class="s2">&quot;medians&quot;</span><span class="p">]:</span>
            <span class="n">med</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">))</span>
            <span class="n">med</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">fly</span> <span class="ow">in</span> <span class="n">artist_dict</span><span class="p">[</span><span class="s2">&quot;fliers&quot;</span><span class="p">]:</span>
            <span class="n">fly</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span>
                            <span class="n">markeredgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                            <span class="n">markersize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fliersize</span><span class="p">))</span>
            <span class="n">fly</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;flier&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">boxplot_kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_boxplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">boxplot_kws</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotate_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_ViolinPlotter</span><span class="p">(</span><span class="n">_CategoricalPlotter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                 <span class="n">bw</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">scale_hue</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">,</span>
                 <span class="n">width</span><span class="p">,</span> <span class="n">inner</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">,</span>
                 <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_colors</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimate_densities</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">scale_hue</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gridsize</span> <span class="o">=</span> <span class="n">gridsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span> <span class="o">=</span> <span class="n">dodge</span>

        <span class="k">if</span> <span class="n">inner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;quart&quot;</span><span class="p">),</span>
                        <span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">),</span>
                        <span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;stick&quot;</span><span class="p">),</span>
                        <span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">)]):</span>
                <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;Inner style &#39;</span><span class="si">{}</span><span class="s2">&#39; not recognized&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">inner</span>

        <span class="k">if</span> <span class="n">split</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;There must be exactly two hue levels to use `split`.&#39;&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="n">split</span>

        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span>

    <span class="k">def</span> <span class="nf">estimate_densities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">scale_hue</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the support and density for all of the data.&quot;&quot;&quot;</span>
        <span class="c1"># Initialize data structures to keep track of plotting data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">support</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">density</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">))</span>
            <span class="n">max_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">support</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">]</span>
            <span class="n">density</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">]</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_names</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">max_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">):</span>

            <span class="c1"># Option 1: we have a single level of grouping</span>
            <span class="c1"># --------------------------------------------</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Strip missing datapoints</span>
                <span class="n">kde_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span>

                <span class="c1"># Handle special case of no data at this level</span>
                <span class="k">if</span> <span class="n">kde_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">support</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
                    <span class="n">density</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]))</span>
                    <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">max_density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">continue</span>

                <span class="c1"># Handle special case of a single unique datapoint</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">kde_data</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">support</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">kde_data</span><span class="p">))</span>
                    <span class="n">density</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]))</span>
                    <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">max_density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">continue</span>

                <span class="c1"># Fit the KDE and get the used bandwidth size</span>
                <span class="n">kde</span><span class="p">,</span> <span class="n">bw_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_kde</span><span class="p">(</span><span class="n">kde_data</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span>

                <span class="c1"># Determine the support grid and get the density over it</span>
                <span class="n">support_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde_support</span><span class="p">(</span><span class="n">kde_data</span><span class="p">,</span> <span class="n">bw_used</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">)</span>
                <span class="n">density_i</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">support_i</span><span class="p">)</span>

                <span class="c1"># Update the data structures with these results</span>
                <span class="n">support</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">support_i</span><span class="p">)</span>
                <span class="n">density</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">density_i</span><span class="p">)</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">kde_data</span><span class="o">.</span><span class="n">size</span>
                <span class="n">max_density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">density_i</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="c1"># Option 2: we have nested grouping by a hue variable</span>
            <span class="c1"># ---------------------------------------------------</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                    <span class="c1"># Handle special case of no data at this category level</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">group_data</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="n">support</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
                        <span class="n">density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]))</span>
                        <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">max_density</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">continue</span>

                    <span class="c1"># Select out the observations for this hue level</span>
                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">hue_level</span>

                    <span class="c1"># Strip missing datapoints</span>
                    <span class="n">kde_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">])</span>

                    <span class="c1"># Handle special case of no data at this level</span>
                    <span class="k">if</span> <span class="n">kde_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">support</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
                        <span class="n">density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]))</span>
                        <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">max_density</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">continue</span>

                    <span class="c1"># Handle special case of a single unique datapoint</span>
                    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">kde_data</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">support</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">kde_data</span><span class="p">))</span>
                        <span class="n">density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]))</span>
                        <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">max_density</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">continue</span>

                    <span class="c1"># Fit the KDE and get the used bandwidth size</span>
                    <span class="n">kde</span><span class="p">,</span> <span class="n">bw_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_kde</span><span class="p">(</span><span class="n">kde_data</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span>

                    <span class="c1"># Determine the support grid and get the density over it</span>
                    <span class="n">support_ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde_support</span><span class="p">(</span><span class="n">kde_data</span><span class="p">,</span> <span class="n">bw_used</span><span class="p">,</span>
                                                  <span class="n">cut</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">)</span>
                    <span class="n">density_ij</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">support_ij</span><span class="p">)</span>

                    <span class="c1"># Update the data structures with these results</span>
                    <span class="n">support</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">support_ij</span><span class="p">)</span>
                    <span class="n">density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">density_ij</span><span class="p">)</span>
                    <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">kde_data</span><span class="o">.</span><span class="n">size</span>
                    <span class="n">max_density</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">density_ij</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="c1"># Scale the height of the density curve.</span>
        <span class="c1"># For a violinplot the density is non-quantitative.</span>
        <span class="c1"># The objective here is to scale the curves relative to 1 so that</span>
        <span class="c1"># they can be multiplied by the width parameter during plotting.</span>

        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;area&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_area</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">max_density</span><span class="p">,</span> <span class="n">scale_hue</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_width</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_count</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">scale_hue</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;scale method &#39;</span><span class="si">{}</span><span class="s2">&#39; not recognized&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scale</span><span class="p">))</span>

        <span class="c1"># Set object attributes that will be used while plotting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support</span> <span class="o">=</span> <span class="n">support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="n">density</span>

    <span class="k">def</span> <span class="nf">fit_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">bw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate a KDE for a vector of data with flexible bandwidth.&quot;&quot;&quot;</span>
        <span class="c1"># Allow for the use of old scipy where `bw` is fixed</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bw</span> <span class="o">!=</span> <span class="s2">&quot;scott&quot;</span><span class="p">:</span>  <span class="c1"># scipy default</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Ignoring bandwidth choice, &quot;</span>
                       <span class="s2">&quot;please upgrade scipy to use a different bandwidth.&quot;</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

        <span class="c1"># Extract the numeric bandwidth from the KDE object</span>
        <span class="n">bw_used</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">factor</span>

        <span class="c1"># At this point, bw will be a numeric scale factor.</span>
        <span class="c1"># To get the actual bandwidth of the kernel, we multiple by the</span>
        <span class="c1"># unbiased standard deviation of the data, which we will use</span>
        <span class="c1"># elsewhere to compute the range of the support.</span>
        <span class="n">bw_used</span> <span class="o">=</span> <span class="n">bw_used</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">kde</span><span class="p">,</span> <span class="n">bw_used</span>

    <span class="k">def</span> <span class="nf">kde_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define a grid of support for the violin.&quot;&quot;&quot;</span>
        <span class="n">support_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">bw</span> <span class="o">*</span> <span class="n">cut</span>
        <span class="n">support_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">bw</span> <span class="o">*</span> <span class="n">cut</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">support_min</span><span class="p">,</span> <span class="n">support_max</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">scale_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">max_density</span><span class="p">,</span> <span class="n">scale_hue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scale the relative area under the KDE curve.</span>

<span class="sd">        This essentially preserves the &quot;standard&quot; KDE scaling, but the</span>
<span class="sd">        resulting maximum density will be 1 so that the curve can be</span>
<span class="sd">        properly multiplied by the violin width.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">density</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">/=</span> <span class="n">max_density</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">density</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">scale_hue</span><span class="p">:</span>
                        <span class="nb">max</span> <span class="o">=</span> <span class="n">max_density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">max</span> <span class="o">=</span> <span class="n">max_density</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">d</span> <span class="o">/=</span> <span class="nb">max</span>

    <span class="k">def</span> <span class="nf">scale_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scale each density curve to the same height.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">density</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">/=</span> <span class="n">d</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">density</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">/=</span> <span class="n">d</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">scale_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">scale_hue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scale each density curve by the number of observations.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">counts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
                    <span class="n">d</span> <span class="o">/=</span> <span class="n">d</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="n">d</span> <span class="o">*=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">counts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">density</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">scale_hue</span><span class="p">:</span>
                            <span class="n">scaler</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">scaler</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">counts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                        <span class="n">d</span> <span class="o">/=</span> <span class="n">d</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                        <span class="n">d</span> <span class="o">*=</span> <span class="n">scaler</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">draw_violins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the violins onto `ax`.&quot;&quot;&quot;</span>
        <span class="n">fill_func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">):</span>

            <span class="n">kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)</span>

            <span class="c1"># Option 1: we have a single level of grouping</span>
            <span class="c1"># --------------------------------------------</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">support</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">support</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="c1"># Handle special case of no observations in this bin</span>
                <span class="k">if</span> <span class="n">support</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Handle special case of a single observation</span>
                <span class="k">elif</span> <span class="n">support</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">support</span><span class="p">)</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_single_observation</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># Draw the violin for this group</span>
                <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridsize</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span>
                <span class="n">fill_func</span><span class="p">(</span><span class="n">support</span><span class="p">,</span>
                          <span class="n">grid</span> <span class="o">-</span> <span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwidth</span><span class="p">,</span>
                          <span class="n">grid</span> <span class="o">+</span> <span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwidth</span><span class="p">,</span>
                          <span class="n">facecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                          <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

                <span class="c1"># Draw the interior representation of the data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Get a nan-free vector of datapoints</span>
                <span class="n">violin_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span>

                <span class="c1"># Draw box and whisker information</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_box_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                <span class="c1"># Draw quartile lines</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;quart&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_quartiles</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                <span class="c1"># Draw stick observations</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;stick&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_stick_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                <span class="c1"># Draw point observations</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

            <span class="c1"># Option 2: we have nested grouping by a hue variable</span>
            <span class="c1"># ---------------------------------------------------</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_offsets</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                    <span class="n">support</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">support</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">kws</span><span class="p">[</span><span class="s2">&quot;facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                    <span class="c1"># Add legend data, but just for one set of violins</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">hue_level</span><span class="p">)</span>

                    <span class="c1"># Handle the special case where we have no observations</span>
                    <span class="k">if</span> <span class="n">support</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># Handle the special case where we have one observation</span>
                    <span class="k">elif</span> <span class="n">support</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">support</span><span class="p">)</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">:</span>
                            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="n">at_group</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">draw_single_observation</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">at_group</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="c1"># Option 2a: we are drawing a single split violin</span>
                    <span class="c1"># -----------------------------------------------</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">:</span>

                        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridsize</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span>
                        <span class="k">if</span> <span class="n">j</span><span class="p">:</span>
                            <span class="n">fill_func</span><span class="p">(</span><span class="n">support</span><span class="p">,</span>
                                      <span class="n">grid</span><span class="p">,</span>
                                      <span class="n">grid</span> <span class="o">+</span> <span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwidth</span><span class="p">,</span>
                                      <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fill_func</span><span class="p">(</span><span class="n">support</span><span class="p">,</span>
                                      <span class="n">grid</span> <span class="o">-</span> <span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwidth</span><span class="p">,</span>
                                      <span class="n">grid</span><span class="p">,</span>
                                      <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

                        <span class="c1"># Draw the interior representation of the data</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="c1"># Get a nan-free vector of datapoints</span>
                        <span class="n">hue_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">hue_level</span>
                        <span class="n">violin_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">])</span>

                        <span class="c1"># Draw quartile lines</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;quart&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">draw_quartiles</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span>
                                                <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
                                                <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

                        <span class="c1"># Draw stick observations</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;stick&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">draw_stick_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span>
                                                  <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
                                                  <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

                        <span class="c1"># The box and point interior plots are drawn for</span>
                        <span class="c1"># all data at the group level, so we just do that once</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="c1"># Get the whole vector for this group level</span>
                        <span class="n">violin_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span>

                        <span class="c1"># Draw box and whisker information</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">draw_box_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span>
                                                <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                        <span class="c1"># Draw point observations</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                    <span class="c1"># Option 2b: we are drawing full nested violins</span>
                    <span class="c1"># -----------------------------------------------</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridsize</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">fill_func</span><span class="p">(</span><span class="n">support</span><span class="p">,</span>
                                  <span class="n">grid</span> <span class="o">-</span> <span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwidth</span><span class="p">,</span>
                                  <span class="n">grid</span> <span class="o">+</span> <span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwidth</span><span class="p">,</span>
                                  <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

                        <span class="c1"># Draw the interior representation</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="c1"># Get a nan-free vector of datapoints</span>
                        <span class="n">hue_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">hue_level</span>
                        <span class="n">violin_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">])</span>

                        <span class="c1"># Draw box and whisker information</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">draw_box_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span>
                                                <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span>
                                                <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                        <span class="c1"># Draw quartile lines</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;quart&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">draw_quartiles</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span>
                                                <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span>
                                                <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                        <span class="c1"># Draw stick observations</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;stick&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">draw_stick_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span>
                                                  <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span>
                                                  <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                        <span class="c1"># Draw point observations</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">violin_data</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">draw_single_observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">at_group</span><span class="p">,</span> <span class="n">at_quant</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw a line to mark a single observation.&quot;&quot;&quot;</span>
        <span class="n">d_width</span> <span class="o">=</span> <span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwidth</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">at_group</span> <span class="o">-</span> <span class="n">d_width</span><span class="p">,</span> <span class="n">at_group</span> <span class="o">+</span> <span class="n">d_width</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">at_quant</span><span class="p">,</span> <span class="n">at_quant</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">at_quant</span><span class="p">,</span> <span class="n">at_quant</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">at_group</span> <span class="o">-</span> <span class="n">d_width</span><span class="p">,</span> <span class="n">at_group</span> <span class="o">+</span> <span class="n">d_width</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_box_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw boxplot information at center of the density.&quot;&quot;&quot;</span>
        <span class="c1"># Compute the boxplot statistics</span>
        <span class="n">q25</span><span class="p">,</span> <span class="n">q50</span><span class="p">,</span> <span class="n">q75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">])</span>
        <span class="n">whisker_lim</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">q25</span> <span class="o">-</span> <span class="n">whisker_lim</span><span class="p">)])</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">q75</span> <span class="o">+</span> <span class="n">whisker_lim</span><span class="p">)])</span>

        <span class="c1"># Draw a boxplot using lines and a point</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">center</span><span class="p">,</span> <span class="n">center</span><span class="p">],</span> <span class="p">[</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">center</span><span class="p">,</span> <span class="n">center</span><span class="p">],</span> <span class="p">[</span><span class="n">q25</span><span class="p">,</span> <span class="n">q75</span><span class="p">],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">q50</span><span class="p">,</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                       <span class="n">edgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                       <span class="n">s</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">],</span> <span class="p">[</span><span class="n">center</span><span class="p">,</span> <span class="n">center</span><span class="p">],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">q25</span><span class="p">,</span> <span class="n">q75</span><span class="p">],</span> <span class="p">[</span><span class="n">center</span><span class="p">,</span> <span class="n">center</span><span class="p">],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">q50</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                       <span class="n">edgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                       <span class="n">s</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">draw_quartiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the quartiles as lines at width of density.&quot;&quot;&quot;</span>
        <span class="n">q25</span><span class="p">,</span> <span class="n">q50</span><span class="p">,</span> <span class="n">q75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_to_density</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">q25</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span>
                             <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span>
                             <span class="n">dashes</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_to_density</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">q50</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span>
                             <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span>
                             <span class="n">dashes</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_to_density</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">q75</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span>
                             <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span>
                             <span class="n">dashes</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw individual observations as points at middle of the violin.&quot;&quot;&quot;</span>
        <span class="n">kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
                   <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                   <span class="n">edgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">*</span> <span class="n">center</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_stick_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span>
                         <span class="n">center</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw individual observations as sticks at width of density.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_to_density</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span>
                                 <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_to_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw a line orthogonal to the value axis at width of density.&quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">support</span> <span class="o">-</span> <span class="n">val</span><span class="p">))</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwidth</span> <span class="o">*</span> <span class="n">density</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">99</span>

        <span class="n">kws</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gray</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">split</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">center</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="n">center</span><span class="p">],</span> <span class="p">[</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">],</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">split</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">center</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="n">width</span><span class="p">],</span> <span class="p">[</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">],</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">center</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="n">width</span><span class="p">],</span> <span class="p">[</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">],</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">split</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">],</span> <span class="p">[</span><span class="n">center</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="n">center</span><span class="p">],</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">split</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">],</span> <span class="p">[</span><span class="n">center</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="n">width</span><span class="p">],</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">],</span> <span class="p">[</span><span class="n">center</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="n">width</span><span class="p">],</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the violin plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_violins</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotate_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_CategoricalScatterPlotter</span><span class="p">(</span><span class="n">_CategoricalPlotter</span><span class="p">):</span>

    <span class="n">default_palette</span> <span class="o">=</span> <span class="s2">&quot;dark&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">point_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a color for each scatter point based on group and hue.&quot;&quot;&quot;</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">):</span>

            <span class="c1"># Initialize the array for this group level</span>
            <span class="n">group_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">group_data</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Use the same color for all points at this level</span>
                <span class="n">group_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">group_colors</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">group_color</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Color the points based on  the hue level</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>
                    <span class="n">hue_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">group_data</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="n">group_colors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">hue_color</span>

            <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_colors</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">colors</span>

    <span class="k">def</span> <span class="nf">add_legend_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add empty scatterplot artists with labels for the legend.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">rgb</span><span class="p">),</span>
                           <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                           <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_StripPlotter</span><span class="p">(</span><span class="n">_CategoricalScatterPlotter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;1-d scatterplot with categorical organization.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                 <span class="n">jitter</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the plotter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_colors</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Set object attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span> <span class="o">=</span> <span class="n">dodge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="o">.</span><span class="mi">8</span>

        <span class="k">if</span> <span class="n">jitter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Use a good default for `jitter = True`</span>
            <span class="n">jlim</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jlim</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jitter</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dodge</span><span class="p">:</span>
            <span class="n">jlim</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitterer</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">jlim</span><span class="p">,</span> <span class="n">jlim</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span>

    <span class="k">def</span> <span class="nf">draw_stripplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the points onto `ax`.&quot;&quot;&quot;</span>
        <span class="c1"># Set the default zorder to 2.1, so that the points</span>
        <span class="c1"># will be drawn on top of line elements (like in a boxplot)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span>
                                         <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                    <span class="c1"># Broken on older numpys</span>
                    <span class="c1"># hue_mask = np.in1d(self.plot_hues[i], self.hue_names)</span>

                <span class="n">strip_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">]</span>

                <span class="c1"># Plot the points in centered positions</span>
                <span class="n">cat_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">strip_data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span>
                <span class="n">cat_pos</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitterer</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strip_data</span><span class="p">))</span>
                <span class="n">kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">point_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">hue_mask</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_pos</span><span class="p">,</span> <span class="n">strip_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">strip_data</span><span class="p">,</span> <span class="n">cat_pos</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_offsets</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>
                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">hue_level</span>
                    <span class="n">strip_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">]</span>

                    <span class="c1"># Plot the points in centered positions</span>
                    <span class="n">center</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">cat_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">strip_data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">center</span>
                    <span class="n">cat_pos</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitterer</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strip_data</span><span class="p">))</span>
                    <span class="n">kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">point_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">hue_mask</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_pos</span><span class="p">,</span> <span class="n">strip_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">strip_data</span><span class="p">,</span> <span class="n">cat_pos</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_stripplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotate_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_SwarmPlotter</span><span class="p">(</span><span class="n">_CategoricalScatterPlotter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                 <span class="n">dodge</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the plotter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_colors</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Set object attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span> <span class="o">=</span> <span class="n">dodge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="o">.</span><span class="mi">8</span>

    <span class="k">def</span> <span class="nf">could_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy_i</span><span class="p">,</span> <span class="n">swarm</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all swarm points that could overlap with target.</span>

<span class="sd">        Assumes that swarm is a sorted list of all points below xy_i.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">y_i</span> <span class="o">=</span> <span class="n">xy_i</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xy_j</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">swarm</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">y_j</span> <span class="o">=</span> <span class="n">xy_j</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">y_i</span> <span class="o">-</span> <span class="n">y_j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xy_j</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">position_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy_i</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of (x, y) coordinates that might be valid.&quot;&quot;&quot;</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">xy_i</span><span class="p">]</span>
        <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span> <span class="o">=</span> <span class="n">xy_i</span>
        <span class="n">left_first</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">x_j</span><span class="p">,</span> <span class="n">y_j</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">y_i</span> <span class="o">-</span> <span class="n">y_j</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.05</span>
            <span class="n">cl</span><span class="p">,</span> <span class="n">cr</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_j</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y_i</span><span class="p">),</span> <span class="p">(</span><span class="n">x_j</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y_i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">left_first</span><span class="p">:</span>
                <span class="n">new_candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">cl</span><span class="p">,</span> <span class="n">cr</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">cr</span><span class="p">,</span> <span class="n">cl</span><span class="p">]</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_candidates</span><span class="p">)</span>
            <span class="n">left_first</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">left_first</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">first_non_overlapping_candidate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove candidates from the list if they overlap with the swarm.&quot;&quot;&quot;</span>

        <span class="c1"># IF we have no neighbours, all candidates are good.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">neighbors_x</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">neighbors_y</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">d_square</span> <span class="o">=</span> <span class="n">d</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="k">for</span> <span class="n">xy_i</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span> <span class="o">=</span> <span class="n">xy_i</span>

            <span class="n">dx</span> <span class="o">=</span> <span class="n">neighbors_x</span> <span class="o">-</span> <span class="n">x_i</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">neighbors_y</span> <span class="o">-</span> <span class="n">y_i</span>

            <span class="n">sq_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>

            <span class="c1"># good candidate does not overlap any of neighbors</span>
            <span class="c1"># which means that squared distance between candidate</span>
            <span class="c1"># and any of the neighbours has to be at least</span>
            <span class="c1"># square of the diameter</span>
            <span class="n">good_candidate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">sq_distances</span> <span class="o">&gt;=</span> <span class="n">d_square</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">good_candidate</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">xy_i</span>

        <span class="c1"># If `position_candidates` works well</span>
        <span class="c1"># this should never happen</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No non-overlapping candidates found. &#39;</span>
                        <span class="s1">&#39;This should not happen.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">beeswarm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_xy</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adjust x position of points to avoid overlaps.&quot;&quot;&quot;</span>
        <span class="c1"># In this method, ``x`` is always the categorical axis</span>
        <span class="c1"># Center of the swarm, in point coordinates</span>
        <span class="n">midline</span> <span class="o">=</span> <span class="n">orig_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Start the swarm with the first point</span>
        <span class="n">swarm</span> <span class="o">=</span> <span class="p">[</span><span class="n">orig_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># Loop over the remaining points</span>
        <span class="k">for</span> <span class="n">xy_i</span> <span class="ow">in</span> <span class="n">orig_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>

            <span class="c1"># Find the points in the swarm that could possibly</span>
            <span class="c1"># overlap with the point we are currently placing</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">could_overlap</span><span class="p">(</span><span class="n">xy_i</span><span class="p">,</span> <span class="n">swarm</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

            <span class="c1"># Find positions that would be valid individually</span>
            <span class="c1"># with respect to each of the swarm neighbors</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_candidates</span><span class="p">(</span><span class="n">xy_i</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

            <span class="c1"># Sort candidates by their centrality</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">candidates</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">midline</span><span class="p">)</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">offsets</span><span class="p">)]</span>

            <span class="c1"># Find the first candidate that does not overlap any neighbours</span>
            <span class="n">new_xy_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_non_overlapping_candidate</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span>
                                                            <span class="n">neighbors</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

            <span class="c1"># Place it into the swarm</span>
            <span class="n">swarm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_xy_i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">swarm</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_gutters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop points from extending beyond their territory.&quot;&quot;&quot;</span>
        <span class="n">half_width</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">low_gutter</span> <span class="o">=</span> <span class="n">center</span> <span class="o">-</span> <span class="n">half_width</span>
        <span class="n">off_low</span> <span class="o">=</span> <span class="n">points</span> <span class="o">&lt;</span> <span class="n">low_gutter</span>
        <span class="k">if</span> <span class="n">off_low</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">points</span><span class="p">[</span><span class="n">off_low</span><span class="p">]</span> <span class="o">=</span> <span class="n">low_gutter</span>
        <span class="n">high_gutter</span> <span class="o">=</span> <span class="n">center</span> <span class="o">+</span> <span class="n">half_width</span>
        <span class="n">off_high</span> <span class="o">=</span> <span class="n">points</span> <span class="o">&gt;</span> <span class="n">high_gutter</span>
        <span class="k">if</span> <span class="n">off_high</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">points</span><span class="p">[</span><span class="n">off_high</span><span class="p">]</span> <span class="o">=</span> <span class="n">high_gutter</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="k">def</span> <span class="nf">swarm_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find new positions on the categorical axis for each point.&quot;&quot;&quot;</span>
        <span class="c1"># Convert from point size (area) to diameter</span>
        <span class="n">default_lw</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;patch.linewidth&quot;</span><span class="p">]</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">kws</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">kws</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lw&quot;</span><span class="p">,</span> <span class="n">default_lw</span><span class="p">))</span>
        <span class="n">dpi</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">lw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dpi</span> <span class="o">/</span> <span class="mi">72</span><span class="p">)</span>

        <span class="c1"># Transform the data coordinates to point coordinates.</span>
        <span class="c1"># We&#39;ll figure out the swarm positions in the latter</span>
        <span class="c1"># and then convert back to data coordinates and replot</span>
        <span class="n">orig_xy</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">get_offsets</span><span class="p">())</span>

        <span class="c1"># Order the variables so that x is the categorical axis</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">orig_xy</span> <span class="o">=</span> <span class="n">orig_xy</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># Do the beeswarm in point coordinates</span>
        <span class="n">new_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beeswarm</span><span class="p">(</span><span class="n">orig_xy</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

        <span class="c1"># Transform the point coordinates back to data coordinates</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">new_xy</span> <span class="o">=</span> <span class="n">new_xy</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">new_xy</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Add gutters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_gutters</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_gutters</span><span class="p">(</span><span class="n">new_y</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="c1"># Reposition the points so they do not overlap</span>
        <span class="n">points</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">draw_swarmplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the data.&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>

        <span class="n">centers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">swarms</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Set the categorical axes limits here for the swarm math</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">)</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">)</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Plot each swarm</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span><span class="p">:</span>

                <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span>
                                         <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                    <span class="c1"># Broken on older numpys</span>
                    <span class="c1"># hue_mask = np.in1d(self.plot_hues[i], self.hue_names)</span>

                <span class="n">swarm_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">]</span>

                <span class="c1"># Sort the points for the beeswarm algorithm</span>
                <span class="n">sorter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">swarm_data</span><span class="p">)</span>
                <span class="n">swarm_data</span> <span class="o">=</span> <span class="n">swarm_data</span><span class="p">[</span><span class="n">sorter</span><span class="p">]</span>
                <span class="n">point_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">hue_mask</span><span class="p">][</span><span class="n">sorter</span><span class="p">]</span>

                <span class="c1"># Plot the points in centered positions</span>
                <span class="n">cat_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">swarm_data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span>
                <span class="n">kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">point_colors</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_pos</span><span class="p">,</span> <span class="n">swarm_data</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">swarm_data</span><span class="p">,</span> <span class="n">cat_pos</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

                <span class="n">centers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">swarms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_offsets</span>
                <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_width</span>

                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>
                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">hue_level</span>
                    <span class="n">swarm_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">]</span>

                    <span class="c1"># Sort the points for the beeswarm algorithm</span>
                    <span class="n">sorter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">swarm_data</span><span class="p">)</span>
                    <span class="n">swarm_data</span> <span class="o">=</span> <span class="n">swarm_data</span><span class="p">[</span><span class="n">sorter</span><span class="p">]</span>
                    <span class="n">point_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">hue_mask</span><span class="p">][</span><span class="n">sorter</span><span class="p">]</span>

                    <span class="c1"># Plot the points in centered positions</span>
                    <span class="n">center</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">cat_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">swarm_data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">center</span>
                    <span class="n">kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">point_colors</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
                        <span class="n">points</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_pos</span><span class="p">,</span> <span class="n">swarm_data</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">points</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">swarm_data</span><span class="p">,</span> <span class="n">cat_pos</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

                    <span class="n">centers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
                    <span class="n">swarms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

        <span class="c1"># Update the position of each point on the categorical axis</span>
        <span class="c1"># Do this after plotting so that the numerical axis limits are correct</span>
        <span class="k">for</span> <span class="n">center</span><span class="p">,</span> <span class="n">swarm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">swarms</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">swarm</span><span class="o">.</span><span class="n">get_offsets</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swarm_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">swarm</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the full plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_swarmplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotate_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_CategoricalStatPlotter</span><span class="p">(</span><span class="n">_CategoricalPlotter</span><span class="p">):</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nested_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A float with the width of plot elements when hue nesting is used.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">return</span> <span class="n">width</span>

    <span class="k">def</span> <span class="nf">estimate_statistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">statistic</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">confint</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">statistic</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">]</span>
            <span class="n">confint</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">):</span>

            <span class="c1"># Option 1: we have a single layer of grouping</span>
            <span class="c1"># --------------------------------------------</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stat_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span>
                    <span class="n">unit_data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unit_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">have</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">group_data</span><span class="p">,</span> <span class="n">unit_data</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">stat_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="p">[</span><span class="n">have</span><span class="p">]</span>
                    <span class="n">unit_data</span> <span class="o">=</span> <span class="n">unit_data</span><span class="p">[</span><span class="n">have</span><span class="p">]</span>

                <span class="c1"># Estimate a statistic from the vector of data</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_data</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="n">statistic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">statistic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">stat_data</span><span class="p">))</span>

                <span class="c1"># Get a confidence interval for this estimate</span>
                <span class="k">if</span> <span class="n">ci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">stat_data</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">confint</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">ci</span> <span class="o">==</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span>

                        <span class="n">estimate</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">(</span><span class="n">stat_data</span><span class="p">)</span>
                        <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">stat_data</span><span class="p">)</span>
                        <span class="n">confint</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">estimate</span> <span class="o">-</span> <span class="n">sd</span><span class="p">,</span> <span class="n">estimate</span> <span class="o">+</span> <span class="n">sd</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">boots</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="n">stat_data</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>
                                          <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span>
                                          <span class="n">units</span><span class="o">=</span><span class="n">unit_data</span><span class="p">)</span>
                        <span class="n">confint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">ci</span><span class="p">(</span><span class="n">boots</span><span class="p">,</span> <span class="n">ci</span><span class="p">))</span>

            <span class="c1"># Option 2: we are grouping by a hue layer</span>
            <span class="c1"># ----------------------------------------</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="n">statistic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">ci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">confint</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
                        <span class="k">continue</span>

                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">hue_level</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">stat_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">])</span>
                        <span class="n">unit_data</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">group_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">have</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">group_data</span><span class="p">,</span> <span class="n">group_units</span><span class="p">]</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">stat_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span> <span class="o">&amp;</span> <span class="n">have</span><span class="p">]</span>
                        <span class="n">unit_data</span> <span class="o">=</span> <span class="n">group_units</span><span class="p">[</span><span class="n">hue_mask</span> <span class="o">&amp;</span> <span class="n">have</span><span class="p">]</span>

                    <span class="c1"># Estimate a statistic from the vector of data</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_data</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="n">statistic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">statistic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">stat_data</span><span class="p">))</span>

                    <span class="c1"># Get a confidence interval for this estimate</span>
                    <span class="k">if</span> <span class="n">ci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">stat_data</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">confint</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
                            <span class="k">continue</span>

                        <span class="k">if</span> <span class="n">ci</span> <span class="o">==</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span>

                            <span class="n">estimate</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">(</span><span class="n">stat_data</span><span class="p">)</span>
                            <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">stat_data</span><span class="p">)</span>
                            <span class="n">confint</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">estimate</span> <span class="o">-</span> <span class="n">sd</span><span class="p">,</span> <span class="n">estimate</span> <span class="o">+</span> <span class="n">sd</span><span class="p">))</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="n">boots</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="n">stat_data</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>
                                              <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span>
                                              <span class="n">units</span><span class="o">=</span><span class="n">unit_data</span><span class="p">)</span>
                            <span class="n">confint</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">ci</span><span class="p">(</span><span class="n">boots</span><span class="p">,</span> <span class="n">ci</span><span class="p">))</span>

        <span class="c1"># Save the resulting values for plotting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">statistic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">confint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_confints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">at_group</span><span class="p">,</span> <span class="n">confint</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span>
                      <span class="n">errwidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">errwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;lw&quot;</span><span class="p">,</span> <span class="n">errwidth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;lw&quot;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">at</span><span class="p">,</span> <span class="p">(</span><span class="n">ci_low</span><span class="p">,</span> <span class="n">ci_high</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">at_group</span><span class="p">,</span>
                                                <span class="n">confint</span><span class="p">,</span>
                                                <span class="n">colors</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">at</span><span class="p">,</span> <span class="n">at</span><span class="p">],</span> <span class="p">[</span><span class="n">ci_low</span><span class="p">,</span> <span class="n">ci_high</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">capsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">at</span> <span class="o">-</span> <span class="n">capsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">at</span> <span class="o">+</span> <span class="n">capsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="p">[</span><span class="n">ci_low</span><span class="p">,</span> <span class="n">ci_low</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">at</span> <span class="o">-</span> <span class="n">capsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">at</span> <span class="o">+</span> <span class="n">capsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="p">[</span><span class="n">ci_high</span><span class="p">,</span> <span class="n">ci_high</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ci_low</span><span class="p">,</span> <span class="n">ci_high</span><span class="p">],</span> <span class="p">[</span><span class="n">at</span><span class="p">,</span> <span class="n">at</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">capsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ci_low</span><span class="p">,</span> <span class="n">ci_low</span><span class="p">],</span>
                            <span class="p">[</span><span class="n">at</span> <span class="o">-</span> <span class="n">capsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">at</span> <span class="o">+</span> <span class="n">capsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ci_high</span><span class="p">,</span> <span class="n">ci_high</span><span class="p">],</span>
                            <span class="p">[</span><span class="n">at</span> <span class="o">-</span> <span class="n">capsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">at</span> <span class="o">+</span> <span class="n">capsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_BarPlotter</span><span class="p">(</span><span class="n">_CategoricalStatPlotter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Show point estimates and confidence intervals with bars.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                 <span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span>
                 <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span> <span class="n">errcolor</span><span class="p">,</span>
                 <span class="n">errwidth</span><span class="p">,</span> <span class="n">capsize</span><span class="p">,</span> <span class="n">dodge</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the plotter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span>
                                 <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_colors</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimate_statistic</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span> <span class="o">=</span> <span class="n">dodge</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">errcolor</span> <span class="o">=</span> <span class="n">errcolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errwidth</span> <span class="o">=</span> <span class="n">errwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capsize</span> <span class="o">=</span> <span class="n">capsize</span>

    <span class="k">def</span> <span class="nf">draw_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the bars onto `ax`.&quot;&quot;&quot;</span>
        <span class="c1"># Get the right matplotlib function depending on the orientation</span>
        <span class="n">barfunc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">barh</span>
        <span class="n">barpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Draw the bars</span>
            <span class="n">barfunc</span><span class="p">(</span><span class="n">barpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

            <span class="c1"># Draw the confidence intervals</span>
            <span class="n">errcolors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">errcolor</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">barpos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_confints</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">barpos</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">confint</span><span class="p">,</span>
                               <span class="n">errcolors</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">errwidth</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">capsize</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                <span class="c1"># Draw the bars</span>
                <span class="n">offpos</span> <span class="o">=</span> <span class="n">barpos</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_offsets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">barfunc</span><span class="p">(</span><span class="n">offpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">[:,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_width</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">hue_level</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

                <span class="c1"># Draw the confidence intervals</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">confint</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="n">confint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confint</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="n">errcolors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">errcolor</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">offpos</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_confints</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span>
                                       <span class="n">offpos</span><span class="p">,</span>
                                       <span class="n">confint</span><span class="p">,</span>
                                       <span class="n">errcolors</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">errwidth</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">capsize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bar_kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_bars</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bar_kws</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotate_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_PointPlotter</span><span class="p">(</span><span class="n">_CategoricalStatPlotter</span><span class="p">):</span>

    <span class="n">default_palette</span> <span class="o">=</span> <span class="s2">&quot;dark&quot;</span>

    <span class="sd">&quot;&quot;&quot;Show point estimates and confidence intervals with (joined) points.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                 <span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span>
                 <span class="n">markers</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span>
                 <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">errwidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the plotter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span>
                                 <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_colors</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimate_statistic</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">)</span>

        <span class="c1"># Override the default palette for single-color plots</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">palette</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_palette</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>

        <span class="c1"># Don&#39;t join single-layer plots with different colors</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">palette</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">join</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Use a good default for `dodge=True`</span>
        <span class="k">if</span> <span class="n">dodge</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dodge</span> <span class="o">=</span> <span class="o">.</span><span class="mi">025</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span>

        <span class="c1"># Make sure we have a marker for each hue level</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="n">markers</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markers</span> <span class="o">=</span> <span class="n">markers</span>

        <span class="c1"># Make sure we have a line style for each hue level</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="n">linestyles</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linestyles</span> <span class="o">=</span> <span class="n">linestyles</span>

        <span class="c1"># Set the other plot components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span> <span class="o">=</span> <span class="n">dodge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join</span> <span class="o">=</span> <span class="n">join</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errwidth</span> <span class="o">=</span> <span class="n">errwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capsize</span> <span class="o">=</span> <span class="n">capsize</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hue_offsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Offsets relative to the center position for each hue level.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">))</span>
            <span class="n">offset</span> <span class="o">-=</span> <span class="n">offset</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">offset</span>

    <span class="k">def</span> <span class="nf">draw_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the main data components of the plot.&quot;&quot;&quot;</span>
        <span class="c1"># Get the center positions on the categorical axis</span>
        <span class="n">pointpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">))</span>

        <span class="c1"># Get the size of the plot elements</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">mew</span> <span class="o">=</span> <span class="n">lw</span> <span class="o">*</span> <span class="o">.</span><span class="mi">75</span>
        <span class="n">markersize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">lw</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Draw lines joining each estimate point</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linestyles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span> <span class="n">pointpos</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pointpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

            <span class="c1"># Draw the confidence intervals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_confints</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">pointpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">confint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">errwidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">capsize</span><span class="p">)</span>

            <span class="c1"># Draw the estimate points</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hex_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span> <span class="n">pointpos</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pointpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                       <span class="n">linewidth</span><span class="o">=</span><span class="n">mew</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                       <span class="n">c</span><span class="o">=</span><span class="n">hex_colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">hex_colors</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_offsets</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                <span class="c1"># Determine the values to plot for this level</span>
                <span class="n">statistic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>

                <span class="c1"># Determine the position on the categorical and z axes</span>
                <span class="n">offpos</span> <span class="o">=</span> <span class="n">pointpos</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1"># Draw lines joining each estimate point</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linestyles</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">statistic</span><span class="p">,</span> <span class="n">offpos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offpos</span><span class="p">,</span> <span class="n">statistic</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

                <span class="c1"># Draw the confidence intervals</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">confint</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="n">confint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confint</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="n">errcolors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">offpos</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_confints</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">offpos</span><span class="p">,</span> <span class="n">confint</span><span class="p">,</span> <span class="n">errcolors</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">errwidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">capsize</span><span class="p">,</span>
                                       <span class="n">zorder</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>

                <span class="c1"># Draw the estimate points</span>
                <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">remove_na</span><span class="p">(</span><span class="n">offpos</span><span class="p">))</span>
                <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">hex_color</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">n_points</span><span class="p">:</span>
                    <span class="n">point_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">hex_color</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_points</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">point_colors</span> <span class="o">=</span> <span class="n">hex_color</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">statistic</span><span class="p">,</span> <span class="n">offpos</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">offpos</span><span class="p">,</span> <span class="n">statistic</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">remove_na</span><span class="p">(</span><span class="n">statistic</span><span class="p">)):</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">hue_level</span><span class="p">,</span>
                           <span class="n">c</span><span class="o">=</span><span class="n">point_colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">point_colors</span><span class="p">,</span>
                           <span class="n">linewidth</span><span class="o">=</span><span class="n">mew</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                           <span class="n">zorder</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotate_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_LVPlotter</span><span class="p">(</span><span class="n">_CategoricalPlotter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                 <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span>
                 <span class="n">width</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">k_depth</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">outlier_prop</span><span class="p">):</span>

        <span class="c1"># TODO assigning variables for None is unneccesary</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="o">.</span><span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dodge</span> <span class="o">=</span> <span class="n">dodge</span>

        <span class="k">if</span> <span class="n">saturation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">saturation</span> <span class="o">=</span> <span class="o">.</span><span class="mi">75</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saturation</span> <span class="o">=</span> <span class="n">saturation</span>

        <span class="k">if</span> <span class="n">k_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">k_depth</span> <span class="o">=</span> <span class="s1">&#39;proportion&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_depth</span> <span class="o">=</span> <span class="n">k_depth</span>

        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span>

        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;exponential&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outlier_prop</span> <span class="o">=</span> <span class="n">outlier_prop</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_colors</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_lv_box_ends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">k_depth</span><span class="o">=</span><span class="s1">&#39;proportion&#39;</span><span class="p">,</span> <span class="n">outlier_prop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of data points and calculate `depth` of</span>
<span class="sd">        letter-value plot.&quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">vals</span><span class="p">)]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="c1"># If p is not set, calculate it so that 8 points are outliers</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">outlier_prop</span><span class="p">:</span>
            <span class="c1"># Conventional boxplots assume this proportion of the data are</span>
            <span class="c1"># outliers.</span>
            <span class="n">p</span> <span class="o">=</span> <span class="mf">0.007</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">outlier_prop</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">outlier_prop</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;outlier_prop not in range [0, 1]!&#39;</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">outlier_prop</span>
        <span class="c1"># Select the depth, i.e. number of boxes to draw, based on the method</span>
        <span class="n">k_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;proportion&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">p</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="s1">&#39;tukey&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
                  <span class="s1">&#39;trustworthy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k_dict</span><span class="p">[</span><span class="n">k_depth</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># If the number happens to be less than 0, set k to 0</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Calculate the upper box ends</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="c1"># Calculate the lower box ends</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="c1"># Stitch the box ends together</span>
        <span class="n">percentile_ends</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)]</span>
        <span class="n">box_ends</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">percentile_ends</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">box_ends</span><span class="p">,</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">_lv_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the outliers based on the letter value depth.&quot;&quot;&quot;</span>
        <span class="n">perc_ends</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)),</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">perc_ends</span><span class="p">)</span>
        <span class="n">lower_out</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vals</span> <span class="o">&lt;</span> <span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">upper_out</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vals</span> <span class="o">&gt;</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">lower_out</span><span class="p">,</span> <span class="n">upper_out</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_width_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width_func</span><span class="p">):</span>
        <span class="c1"># Dictionary of functions for computing the width of the boxes</span>
        <span class="n">width_functions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">,</span>
                           <span class="s1">&#39;exponential&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                           <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">h</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">width_functions</span><span class="p">[</span><span class="n">width_func</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_lvplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box_data</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">255.</span> <span class="o">/</span> <span class="mf">256.</span><span class="p">,</span> <span class="mf">185.</span> <span class="o">/</span> <span class="mf">256.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                <span class="n">vert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">widths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_depth</span><span class="o">=</span><span class="s1">&#39;proportion&#39;</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outlier_prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kws</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">box_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">box_data</span><span class="p">)</span>

        <span class="c1"># If we only have one data point, plot a line</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kws</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">})</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="n">widths</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">widths</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">vert</span><span class="p">:</span>
                <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">ys</span><span class="p">,</span> <span class="n">xs</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get the number of data points and calculate &quot;depth&quot; of</span>
            <span class="c1"># letter-value plot</span>
            <span class="n">box_ends</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lv_box_ends</span><span class="p">(</span><span class="n">box_data</span><span class="p">,</span> <span class="n">k_depth</span><span class="o">=</span><span class="n">k_depth</span><span class="p">,</span>
                                            <span class="n">outlier_prop</span><span class="o">=</span><span class="n">outlier_prop</span><span class="p">)</span>

            <span class="c1"># Anonymous functions for calculating the width and height</span>
            <span class="c1"># of the letter value boxes</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width_functions</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

            <span class="c1"># Function to find height of boxes</span>
            <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Functions to construct the letter value boxes</span>
            <span class="k">def</span> <span class="nf">vert_perc_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
                <span class="n">rect</span> <span class="o">=</span> <span class="n">Patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">widths</span><span class="o">*</span><span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                         <span class="n">widths</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                                         <span class="n">height</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">rect</span>

            <span class="k">def</span> <span class="nf">horz_perc_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
                <span class="n">rect</span> <span class="o">=</span> <span class="n">Patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span> <span class="o">-</span> <span class="n">widths</span><span class="o">*</span><span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                         <span class="n">height</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">widths</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                                         <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">rect</span>

            <span class="c1"># Scale the width of the boxes so the biggest starts at 1</span>
            <span class="n">w_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">width</span><span class="p">(</span><span class="n">height</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">box_ends</span><span class="p">)])</span>
            <span class="n">w_area</span> <span class="o">=</span> <span class="n">w_area</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">w_area</span><span class="p">)</span>

            <span class="c1"># Calculate the medians</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">box_data</span><span class="p">)</span>

            <span class="c1"># Calculate the outliers and plot</span>
            <span class="n">outliers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lv_outliers</span><span class="p">(</span><span class="n">box_data</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">vert</span><span class="p">:</span>
                <span class="n">boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">vert_perc_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                         <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">box_ends</span><span class="p">,</span> <span class="n">w_area</span><span class="p">))]</span>

                <span class="c1"># Plot the medians</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="n">widths</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">widths</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
                        <span class="n">c</span><span class="o">=</span><span class="s1">&#39;.15&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">45</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)),</span> <span class="n">outliers</span><span class="p">,</span>
                           <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">color</span><span class="p">),</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">horz_perc_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                         <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">box_ends</span><span class="p">,</span> <span class="n">w_area</span><span class="p">))]</span>

                <span class="c1"># Plot the medians</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="n">widths</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">widths</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">c</span><span class="o">=</span><span class="s1">&#39;.15&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">45</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">outliers</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)),</span>
                           <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

            <span class="c1"># Construct a color map from the input color</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">color</span><span class="p">)]</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;new_map&#39;</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

            <span class="c1"># Set the color gradation</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">boxes</span><span class="p">))))</span>

            <span class="c1"># Plot the boxes</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_letter_value_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use matplotlib to draw a letter value plot on an Axes.&quot;&quot;&quot;</span>
        <span class="n">vert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Handle case where there is data at this level</span>
                <span class="k">if</span> <span class="n">group_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Draw a single box or a set of boxes</span>
                <span class="c1"># with a single level of grouping</span>
                <span class="n">box_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span>

                <span class="c1"># Handle case where there is no non-null data</span>
                <span class="k">if</span> <span class="n">box_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_lvplot</span><span class="p">(</span><span class="n">box_data</span><span class="p">,</span>
                             <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                             <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                             <span class="n">vert</span><span class="o">=</span><span class="n">vert</span><span class="p">,</span>
                             <span class="n">widths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                             <span class="n">k_depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_depth</span><span class="p">,</span>
                             <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                             <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
                             <span class="n">outlier_prop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outlier_prop</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Draw nested groups of boxes</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue_offsets</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">hue_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue_names</span><span class="p">):</span>

                    <span class="c1"># Add a legend for this hue level</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_legend_data</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">hue_level</span><span class="p">)</span>

                    <span class="c1"># Handle case where there is data at this level</span>
                    <span class="k">if</span> <span class="n">group_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">hue_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">hue_level</span>
                    <span class="n">box_data</span> <span class="o">=</span> <span class="n">remove_na</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="n">hue_mask</span><span class="p">])</span>

                    <span class="c1"># Handle case where there is no non-null data</span>
                    <span class="k">if</span> <span class="n">box_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">center</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_lvplot</span><span class="p">(</span><span class="n">box_data</span><span class="p">,</span>
                                 <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="n">center</span><span class="p">],</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                 <span class="n">vert</span><span class="o">=</span><span class="n">vert</span><span class="p">,</span>
                                 <span class="n">widths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nested_width</span><span class="p">,</span>
                                 <span class="n">k_depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_depth</span><span class="p">,</span>
                                 <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                                 <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
                                 <span class="n">outlier_prop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outlier_prop</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">boxplot_kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_letter_value_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">boxplot_kws</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotate_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


<span class="n">_categorical_docs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>

    <span class="c1"># Shared narrative docs</span>
    <span class="n">categorical_narrative</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    This function always treats one of the variables as categorical and</span>
<span class="s2">    draws data at ordinal positions (0, 1, ... n) on the relevant axis, even</span>
<span class="s2">    when the data has a numeric or date type.</span>

<span class="s2">    See the :ref:`tutorial &lt;categorical_tutorial&gt;` for more information.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">main_api_narrative</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>

<span class="s2">    Input data can be passed in a variety of formats, including:</span>

<span class="s2">    - Vectors of data represented as lists, numpy arrays, or pandas Series</span>
<span class="s2">      objects passed directly to the ``x``, ``y``, and/or ``hue`` parameters.</span>
<span class="s2">    - A &quot;long-form&quot; DataFrame, in which case the ``x``, ``y``, and ``hue``</span>
<span class="s2">      variables will determine how the data are plotted.</span>
<span class="s2">    - A &quot;wide-form&quot; DataFrame, such that each numeric column will be plotted.</span>
<span class="s2">    - An array or list of vectors.</span>

<span class="s2">    In most cases, it is possible to use numpy or Python objects, but pandas</span>
<span class="s2">    objects are preferable because the associated names will be used to</span>
<span class="s2">    annotate the axes. Additionally, you can use Categorical types for the</span>
<span class="s2">    grouping variables to control the order of plot elements.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>

    <span class="c1"># Shared function parameters</span>
    <span class="n">input_params</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    x, y, hue : names of variables in ``data`` or vector data, optional</span>
<span class="s2">        Inputs for plotting long-form data. See examples for interpretation.</span><span class="se">\</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">string_input_params</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    x, y, hue : names of variables in ``data``</span>
<span class="s2">        Inputs for plotting long-form data. See examples for interpretation.</span><span class="se">\</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">categorical_data</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    data : DataFrame, array, or list of arrays, optional</span>
<span class="s2">        Dataset for plotting. If ``x`` and ``y`` are absent, this is</span>
<span class="s2">        interpreted as wide-form. Otherwise it is expected to be long-form.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">long_form_data</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    data : DataFrame</span>
<span class="s2">        Long-form (tidy) dataset for plotting. Each column should correspond</span>
<span class="s2">        to a variable, and each row should correspond to an observation.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">order_vars</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    order, hue_order : lists of strings, optional</span>
<span class="s2">        Order to plot the categorical levels in, otherwise the levels are</span>
<span class="s2">        inferred from the data objects.</span><span class="se">\</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">stat_api_params</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    estimator : callable that maps vector -&gt; scalar, optional</span>
<span class="s2">        Statistical function to estimate within each categorical bin.</span>
<span class="s2">    ci : float or &quot;sd&quot; or None, optional</span>
<span class="s2">        Size of confidence intervals to draw around estimated values.  If</span>
<span class="s2">        &quot;sd&quot;, skip bootstrapping and draw the standard deviation of the</span>
<span class="s2">        observations. If ``None``, no bootstrapping will be performed, and</span>
<span class="s2">        error bars will not be drawn.</span>
<span class="s2">    n_boot : int, optional</span>
<span class="s2">        Number of bootstrap iterations to use when computing confidence</span>
<span class="s2">        intervals.</span>
<span class="s2">    units : name of variable in ``data`` or vector data, optional</span>
<span class="s2">        Identifier of sampling units, which will be used to perform a</span>
<span class="s2">        multilevel bootstrap and account for repeated measures design.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">orient</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    orient : &quot;v&quot; | &quot;h&quot;, optional</span>
<span class="s2">        Orientation of the plot (vertical or horizontal). This is usually</span>
<span class="s2">        inferred from the dtype of the input variables, but can be used to</span>
<span class="s2">        specify when the &quot;categorical&quot; variable is a numeric or when plotting</span>
<span class="s2">        wide-form data.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    color : matplotlib color, optional</span>
<span class="s2">        Color for all of the elements, or seed for a gradient palette.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">palette</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    palette : palette name, list, or dict, optional</span>
<span class="s2">        Color palette that maps either the grouping variable or the hue</span>
<span class="s2">        variable. If the palette is a dictionary, keys should be names of</span>
<span class="s2">        levels and values should be matplotlib colors.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">saturation</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    saturation : float, optional</span>
<span class="s2">        Proportion of the original saturation to draw colors at. Large patches</span>
<span class="s2">        often look better with slightly desaturated colors, but set this to</span>
<span class="s2">        ``1`` if you want the plot colors to perfectly match the input color</span>
<span class="s2">        spec.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">capsize</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">         capsize : float, optional</span>
<span class="s2">             Width of the &quot;caps&quot; on error bars.</span>
<span class="s2">         &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">errwidth</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">         errwidth : float, optional</span>
<span class="s2">             Thickness of error bar lines (and caps).</span><span class="se">\</span>
<span class="s2">         &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">width</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    width : float, optional</span>
<span class="s2">        Width of a full element when not using hue nesting, or width of all the</span>
<span class="s2">        elements for one level of the major grouping variable.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">dodge</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    dodge : bool, optional</span>
<span class="s2">        When hue nesting is used, whether elements should be shifted along the</span>
<span class="s2">        categorical axis.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    linewidth : float, optional</span>
<span class="s2">        Width of the gray lines that frame the plot elements.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">ax_in</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    ax : matplotlib Axes, optional</span>
<span class="s2">        Axes object to draw the plot onto, otherwise uses the current Axes.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">ax_out</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    ax : matplotlib Axes</span>
<span class="s2">        Returns the Axes object with the plot drawn onto it.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>

    <span class="c1"># Shared see also</span>
    <span class="n">boxplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    boxplot : A traditional box-and-whisker plot with a similar API.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">violinplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    violinplot : A combination of boxplot and kernel density estimation.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">stripplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    stripplot : A scatterplot where one variable is categorical. Can be used</span>
<span class="s2">                in conjunction with other plots to show each observation.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">swarmplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    swarmplot : A categorical scatterplot where the points do not overlap. Can</span>
<span class="s2">                be used with other plots to show each observation.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">barplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    barplot : Show point estimates and confidence intervals using bars.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">countplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    countplot : Show the counts of observations in each categorical bin.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">pointplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    pointplot : Show point estimates and confidence intervals using scatterplot</span>
<span class="s2">                glyphs.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">catplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    catplot : Combine a categorical plot with a class:`FacetGrid`.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">boxenplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    boxenplot : An enhanced boxplot for larger datasets.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>

    <span class="p">)</span>

<span class="n">_categorical_docs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_facet_docs</span><span class="p">)</span>


<div class="viewcode-block" id="boxplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.boxplot">[docs]</a><span class="k">def</span> <span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fliersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">whis</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_BoxPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                          <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span>
                          <span class="n">width</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">fliersize</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">whis</span><span class="o">=</span><span class="n">whis</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="n">notch</span><span class="p">))</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="n">boxplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Draw a box plot to show distributions with respect to categories.</span>

<span class="s2">    A box plot (or box-and-whisker plot) shows the distribution of quantitative</span>
<span class="s2">    data in a way that facilitates comparisons between variables or across</span>
<span class="s2">    levels of a categorical variable. The box shows the quartiles of the</span>
<span class="s2">    dataset while the whiskers extend to show the rest of the distribution,</span>
<span class="s2">    except for points that are determined to be &quot;outliers&quot; using a method</span>
<span class="s2">    that is a function of the inter-quartile range.</span>

<span class="s2">    </span><span class="si">{main_api_narrative}</span><span class="s2"></span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{categorical_data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{saturation}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{width}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{dodge}</span><span class="s2"></span>
<span class="s2">    fliersize : float, optional</span>
<span class="s2">        Size of the markers used to indicate outlier observations.</span>
<span class="s2">    </span><span class="si">{linewidth}</span><span class="s2"></span>
<span class="s2">    whis : float, optional</span>
<span class="s2">        Proportion of the IQR past the low and high quartiles to extend the</span>
<span class="s2">        plot whiskers. Points outside this range will be identified as</span>
<span class="s2">        outliers.</span>
<span class="s2">    notch : boolean, optional</span>
<span class="s2">        Whether to &quot;notch&quot; the box to indicate a confidence interval for the</span>
<span class="s2">        median. There are several other parameters that can control how the</span>
<span class="s2">        notches are drawn; see the ``plt.boxplot`` help for more information</span>
<span class="s2">        on them.</span>
<span class="s2">    </span><span class="si">{ax_in}</span><span class="s2"></span>
<span class="s2">    kwargs : key, value mappings</span>
<span class="s2">        Other keyword arguments are passed through to ``plt.boxplot`` at draw</span>
<span class="s2">        time.</span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    </span><span class="si">{ax_out}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    </span><span class="si">{violinplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{stripplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{swarmplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Draw a single horizontal boxplot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;whitegrid&quot;)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=tips[&quot;total_bill&quot;])</span>

<span class="s2">    Draw a vertical boxplot grouped by a categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips)</span>

<span class="s2">    Draw a boxplot with nested grouping by two categorical variables:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                  data=tips, palette=&quot;Set3&quot;)</span>

<span class="s2">    Draw a boxplot with nested grouping when some bins are empty:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;time&quot;,</span>
<span class="s2">        ...                  data=tips, linewidth=2.5)</span>

<span class="s2">    Control box order by passing an explicit order:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=&quot;time&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="s2">        ...                  order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>

<span class="s2">    Draw a boxplot for each numeric variable in a DataFrame:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; iris = sns.load_dataset(&quot;iris&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(data=iris, orient=&quot;h&quot;, palette=&quot;Set2&quot;)</span>

<span class="s2">    Use ``hue`` without changing box position or width:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; tips[&quot;weekend&quot;] = tips[&quot;day&quot;].isin([&quot;Sat&quot;, &quot;Sun&quot;])</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;weekend&quot;,</span>
<span class="s2">        ...                  data=tips, dodge=False)</span>

<span class="s2">    Use :func:`swarmplot` to show the datapoints on top of the boxes:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips, color=&quot;.25&quot;)</span>

<span class="s2">    Use :func:`catplot` to combine a :func:`pointplot` and a</span>
<span class="s2">    :class:`FacetGrid`. This allows grouping within additional categorical</span>
<span class="s2">    variables. Using :func:`catplot` is safer than using :class:`FacetGrid`</span>
<span class="s2">    directly, as it ensures synchronization of variable order across facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;sex&quot;, y=&quot;total_bill&quot;,</span>
<span class="s2">        ...                 hue=&quot;smoker&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                 data=tips, kind=&quot;box&quot;,</span>
<span class="s2">        ...                 height=4, aspect=.7);</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>


<div class="viewcode-block" id="violinplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.violinplot">[docs]</a><span class="k">def</span> <span class="nf">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bw</span><span class="o">=</span><span class="s2">&quot;scott&quot;</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="n">scale_hue</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
               <span class="n">width</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
               <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_ViolinPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                             <span class="n">bw</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">scale_hue</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">,</span>
                             <span class="n">width</span><span class="p">,</span> <span class="n">inner</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">,</span>
                             <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="n">violinplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Draw a combination of boxplot and kernel density estimate.</span>

<span class="s2">    A violin plot plays a similar role as a box and whisker plot. It shows the</span>
<span class="s2">    distribution of quantitative data across several levels of one (or more)</span>
<span class="s2">    categorical variables such that those distributions can be compared. Unlike</span>
<span class="s2">    a box plot, in which all of the plot components correspond to actual</span>
<span class="s2">    datapoints, the violin plot features a kernel density estimation of the</span>
<span class="s2">    underlying distribution.</span>

<span class="s2">    This can be an effective and attractive way to show multiple distributions</span>
<span class="s2">    of data at once, but keep in mind that the estimation procedure is</span>
<span class="s2">    influenced by the sample size, and violins for relatively small samples</span>
<span class="s2">    might look misleadingly smooth.</span>

<span class="s2">    </span><span class="si">{main_api_narrative}</span><span class="s2"></span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{categorical_data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    bw : {{&#39;scott&#39;, &#39;silverman&#39;, float}}, optional</span>
<span class="s2">        Either the name of a reference rule or the scale factor to use when</span>
<span class="s2">        computing the kernel bandwidth. The actual kernel size will be</span>
<span class="s2">        determined by multiplying the scale factor by the standard deviation of</span>
<span class="s2">        the data within each bin.</span>
<span class="s2">    cut : float, optional</span>
<span class="s2">        Distance, in units of bandwidth size, to extend the density past the</span>
<span class="s2">        extreme datapoints. Set to 0 to limit the violin range within the range</span>
<span class="s2">        of the observed data (i.e., to have the same effect as ``trim=True`` in</span>
<span class="s2">        ``ggplot``.</span>
<span class="s2">    scale : {{&quot;area&quot;, &quot;count&quot;, &quot;width&quot;}}, optional</span>
<span class="s2">        The method used to scale the width of each violin. If ``area``, each</span>
<span class="s2">        violin will have the same area. If ``count``, the width of the violins</span>
<span class="s2">        will be scaled by the number of observations in that bin. If ``width``,</span>
<span class="s2">        each violin will have the same width.</span>
<span class="s2">    scale_hue : bool, optional</span>
<span class="s2">        When nesting violins using a ``hue`` variable, this parameter</span>
<span class="s2">        determines whether the scaling is computed within each level of the</span>
<span class="s2">        major grouping variable (``scale_hue=True``) or across all the violins</span>
<span class="s2">        on the plot (``scale_hue=False``).</span>
<span class="s2">    gridsize : int, optional</span>
<span class="s2">        Number of points in the discrete grid used to compute the kernel</span>
<span class="s2">        density estimate.</span>
<span class="s2">    </span><span class="si">{width}</span><span class="s2"></span>
<span class="s2">    inner : {{&quot;box&quot;, &quot;quartile&quot;, &quot;point&quot;, &quot;stick&quot;, None}}, optional</span>
<span class="s2">        Representation of the datapoints in the violin interior. If ``box``,</span>
<span class="s2">        draw a miniature boxplot. If ``quartiles``, draw the quartiles of the</span>
<span class="s2">        distribution.  If ``point`` or ``stick``, show each underlying</span>
<span class="s2">        datapoint. Using ``None`` will draw unadorned violins.</span>
<span class="s2">    split : bool, optional</span>
<span class="s2">        When using hue nesting with a variable that takes two levels, setting</span>
<span class="s2">        ``split`` to True will draw half of a violin for each level. This can</span>
<span class="s2">        make it easier to directly compare the distributions.</span>
<span class="s2">    </span><span class="si">{dodge}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{linewidth}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{saturation}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{ax_in}</span><span class="s2"></span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    </span><span class="si">{ax_out}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    </span><span class="si">{boxplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{stripplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{swarmplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Draw a single horizontal violinplot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;whitegrid&quot;)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=tips[&quot;total_bill&quot;])</span>

<span class="s2">    Draw a vertical violinplot grouped by a categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips)</span>

<span class="s2">    Draw a violinplot with nested grouping by two categorical variables:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                     data=tips, palette=&quot;muted&quot;)</span>

<span class="s2">    Draw split violins to compare the across the hue variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                     data=tips, palette=&quot;muted&quot;, split=True)</span>

<span class="s2">    Control violin order by passing an explicit order:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;time&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="s2">        ...                     order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>

<span class="s2">    Scale the violin width by the number of observations in each bin:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;,</span>
<span class="s2">        ...                     data=tips, palette=&quot;Set2&quot;, split=True,</span>
<span class="s2">        ...                     scale=&quot;count&quot;)</span>

<span class="s2">    Draw the quartiles as horizontal lines instead of a mini-box:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;,</span>
<span class="s2">        ...                     data=tips, palette=&quot;Set2&quot;, split=True,</span>
<span class="s2">        ...                     scale=&quot;count&quot;, inner=&quot;quartile&quot;)</span>

<span class="s2">    Show each observation with a stick inside the violin:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;,</span>
<span class="s2">        ...                     data=tips, palette=&quot;Set2&quot;, split=True,</span>
<span class="s2">        ...                     scale=&quot;count&quot;, inner=&quot;stick&quot;)</span>

<span class="s2">    Scale the density relative to the counts across all bins:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;,</span>
<span class="s2">        ...                     data=tips, palette=&quot;Set2&quot;, split=True,</span>
<span class="s2">        ...                     scale=&quot;count&quot;, inner=&quot;stick&quot;, scale_hue=False)</span>

<span class="s2">    Use a narrow bandwidth to reduce the amount of smoothing:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;,</span>
<span class="s2">        ...                     data=tips, palette=&quot;Set2&quot;, split=True,</span>
<span class="s2">        ...                     scale=&quot;count&quot;, inner=&quot;stick&quot;,</span>
<span class="s2">        ...                     scale_hue=False, bw=.2)</span>

<span class="s2">    Draw horizontal violins:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; planets = sns.load_dataset(&quot;planets&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;orbital_period&quot;, y=&quot;method&quot;,</span>
<span class="s2">        ...                     data=planets[planets.orbital_period &lt; 1000],</span>
<span class="s2">        ...                     scale=&quot;width&quot;, palette=&quot;Set3&quot;)</span>

<span class="s2">    Don&#39;t let density extend past extreme values in the data:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;orbital_period&quot;, y=&quot;method&quot;,</span>
<span class="s2">        ...                     data=planets[planets.orbital_period &lt; 1000],</span>
<span class="s2">        ...                     cut=0, scale=&quot;width&quot;, palette=&quot;Set3&quot;)</span>

<span class="s2">    Use ``hue`` without changing violin position or width:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; tips[&quot;weekend&quot;] = tips[&quot;day&quot;].isin([&quot;Sat&quot;, &quot;Sun&quot;])</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;weekend&quot;,</span>
<span class="s2">        ...                     data=tips, dodge=False)</span>

<span class="s2">    Use :func:`catplot` to combine a :func:`violinplot` and a</span>
<span class="s2">    :class:`FacetGrid`. This allows grouping within additional categorical</span>
<span class="s2">    variables. Using :func:`catplot` is safer than using :class:`FacetGrid`</span>
<span class="s2">    directly, as it ensures synchronization of variable order across facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;sex&quot;, y=&quot;total_bill&quot;,</span>
<span class="s2">        ...                 hue=&quot;smoker&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                 data=tips, kind=&quot;violin&quot;, split=True,</span>
<span class="s2">        ...                 height=4, aspect=.7);</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">lvplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Deprecated; please use `boxenplot`.&quot;&quot;&quot;</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;The `lvplot` function has been renamed to `boxenplot`. The original &quot;</span>
        <span class="s2">&quot;name will be removed in a future release. Please update your code. &quot;</span>
    <span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">boxenplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">boxenplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
              <span class="n">width</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">k_depth</span><span class="o">=</span><span class="s1">&#39;proportion&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span> <span class="n">outlier_prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_LVPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                         <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span>
                         <span class="n">width</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">k_depth</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span>
                         <span class="n">outlier_prop</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="n">boxenplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Draw an enhanced box plot for larger datasets.</span>

<span class="s2">    This style of plot was originally named a &quot;letter value&quot; plot because it</span>
<span class="s2">    shows a large number of quantiles that are defined as &quot;letter values&quot;.  It</span>
<span class="s2">    is similar to a box plot in plotting a nonparametric representation of a</span>
<span class="s2">    distribution in which all features correspond to actual observations. By</span>
<span class="s2">    plotting more quantiles, it provides more information about the shape of</span>
<span class="s2">    the distribution, particularly in the tails. For a more extensive</span>
<span class="s2">    explanation, you can read the paper that introduced the plot:</span>

<span class="s2">    https://vita.had.co.nz/papers/letter-value-plot.html</span>

<span class="s2">    </span><span class="si">{main_api_narrative}</span><span class="s2"></span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{categorical_data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{saturation}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{width}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{dodge}</span><span class="s2"></span>
<span class="s2">    k_depth : &quot;proportion&quot; | &quot;tukey&quot; | &quot;trustworthy&quot;, optional</span>
<span class="s2">        The number of boxes, and by extension number of percentiles, to draw.</span>
<span class="s2">        All methods are detailed in Wickham&#39;s paper. Each makes different</span>
<span class="s2">        assumptions about the number of outliers and leverages different</span>
<span class="s2">        statistical properties.</span>
<span class="s2">    </span><span class="si">{linewidth}</span><span class="s2"></span>
<span class="s2">    scale : &quot;linear&quot; | &quot;exponential&quot; | &quot;area&quot;</span>
<span class="s2">        Method to use for the width of the letter value boxes. All give similar</span>
<span class="s2">        results visually. &quot;linear&quot; reduces the width by a constant linear</span>
<span class="s2">        factor, &quot;exponential&quot; uses the proportion of data not covered, &quot;area&quot;</span>
<span class="s2">        is proportional to the percentage of data covered.</span>
<span class="s2">    outlier_prop : float, optional</span>
<span class="s2">        Proportion of data believed to be outliers. Used in conjunction with</span>
<span class="s2">        k_depth to determine the number of percentiles to draw. Defaults to</span>
<span class="s2">        0.007 as a proportion of outliers. Should be in range [0, 1].</span>
<span class="s2">    </span><span class="si">{ax_in}</span><span class="s2"></span>
<span class="s2">    kwargs : key, value mappings</span>
<span class="s2">        Other keyword arguments are passed through to ``plt.plot`` and</span>
<span class="s2">        ``plt.scatter`` at draw time.</span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    </span><span class="si">{ax_out}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    </span><span class="si">{violinplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{boxplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Draw a single horizontal boxen plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;whitegrid&quot;)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.boxenplot(x=tips[&quot;total_bill&quot;])</span>

<span class="s2">    Draw a vertical boxen plot grouped by a categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxenplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips)</span>

<span class="s2">    Draw a letter value plot with nested grouping by two categorical variables:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxenplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                    data=tips, palette=&quot;Set3&quot;)</span>

<span class="s2">    Draw a boxen plot with nested grouping when some bins are empty:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxenplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;time&quot;,</span>
<span class="s2">        ...                    data=tips, linewidth=2.5)</span>

<span class="s2">    Control box order by passing an explicit order:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxenplot(x=&quot;time&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="s2">        ...                    order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>

<span class="s2">    Draw a boxen plot for each numeric variable in a DataFrame:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; iris = sns.load_dataset(&quot;iris&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.boxenplot(data=iris, orient=&quot;h&quot;, palette=&quot;Set2&quot;)</span>

<span class="s2">    Use :func:`stripplot` to show the datapoints on top of the boxes:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxenplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                    size=4, jitter=True, color=&quot;gray&quot;)</span>

<span class="s2">    Use :func:`catplot` to combine :func:`boxenplot` and a :class:`FacetGrid`.</span>
<span class="s2">    This allows grouping within additional categorical variables. Using</span>
<span class="s2">    :func:`catplot` is safer than using :class:`FacetGrid` directly, as it</span>
<span class="s2">    ensures synchronization of variable order across facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;sex&quot;, y=&quot;total_bill&quot;,</span>
<span class="s2">        ...                 hue=&quot;smoker&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                 data=tips, kind=&quot;boxen&quot;,</span>
<span class="s2">        ...                 height=4, aspect=.7);</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>


<div class="viewcode-block" id="stripplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.stripplot">[docs]</a><span class="k">def</span> <span class="nf">stripplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="s2">&quot;split&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">dodge</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The `split` parameter has been renamed to `dodge`.&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_StripPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                            <span class="n">jitter</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;zorder&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">edgecolor</span> <span class="o">==</span> <span class="s2">&quot;gray&quot;</span><span class="p">:</span>
        <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">gray</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">size</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                       <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">))</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="n">stripplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Draw a scatterplot where one variable is categorical.</span>

<span class="s2">    A strip plot can be drawn on its own, but it is also a good complement</span>
<span class="s2">    to a box or violin plot in cases where you want to show all observations</span>
<span class="s2">    along with some representation of the underlying distribution.</span>

<span class="s2">    </span><span class="si">{main_api_narrative}</span><span class="s2"></span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{categorical_data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    jitter : float, ``True``/``1`` is special-cased, optional</span>
<span class="s2">        Amount of jitter (only along the categorical axis) to apply. This</span>
<span class="s2">        can be useful when you have many points and they overlap, so that</span>
<span class="s2">        it is easier to see the distribution. You can specify the amount</span>
<span class="s2">        of jitter (half the width of the uniform random variable support),</span>
<span class="s2">        or just use ``True`` for a good default.</span>
<span class="s2">    dodge : bool, optional</span>
<span class="s2">        When using ``hue`` nesting, setting this to ``True`` will separate</span>
<span class="s2">        the strips for different hue levels along the categorical axis.</span>
<span class="s2">        Otherwise, the points for each level will be plotted on top of</span>
<span class="s2">        each other.</span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    size : float, optional</span>
<span class="s2">        Diameter of the markers, in points. (Although ``plt.scatter`` is used</span>
<span class="s2">        to draw the points, the ``size`` argument here takes a &quot;normal&quot;</span>
<span class="s2">        markersize and not size^2 like ``plt.scatter``.</span>
<span class="s2">    edgecolor : matplotlib color, &quot;gray&quot; is special-cased, optional</span>
<span class="s2">        Color of the lines around each point. If you pass ``&quot;gray&quot;``, the</span>
<span class="s2">        brightness is determined by the color palette used for the body</span>
<span class="s2">        of the points.</span>
<span class="s2">    </span><span class="si">{linewidth}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{ax_in}</span><span class="s2"></span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    </span><span class="si">{ax_out}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    </span><span class="si">{swarmplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{boxplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{violinplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Draw a single horizontal strip plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;whitegrid&quot;)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=tips[&quot;total_bill&quot;])</span>

<span class="s2">    Group the strips by a categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips)</span>

<span class="s2">    Add jitter to bring out the distribution of values:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips, jitter=True)</span>

<span class="s2">    Use a smaller amount of jitter:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips, jitter=0.05)</span>

<span class="s2">    Draw horizontal strips:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;total_bill&quot;, y=&quot;day&quot;, data=tips,</span>
<span class="s2">        ...                    jitter=True)</span>

<span class="s2">    Draw outlines around the points:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;total_bill&quot;, y=&quot;day&quot;, data=tips,</span>
<span class="s2">        ...                    jitter=True, linewidth=1)</span>

<span class="s2">    Nest the strips within a second categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;sex&quot;, y=&quot;total_bill&quot;, hue=&quot;day&quot;,</span>
<span class="s2">        ...                    data=tips, jitter=True)</span>

<span class="s2">    Draw each level of the ``hue`` variable at different locations on the</span>
<span class="s2">    major categorical axis:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                    data=tips, jitter=True,</span>
<span class="s2">        ...                    palette=&quot;Set2&quot;, dodge=True)</span>

<span class="s2">    Control strip order by passing an explicit order:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;time&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="s2">        ...                    order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>

<span class="s2">    Draw strips with large points and different aesthetics:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax =  sns.stripplot(&quot;day&quot;, &quot;total_bill&quot;, &quot;smoker&quot;, data=tips,</span>
<span class="s2">        ...                    palette=&quot;Set2&quot;, size=20, marker=&quot;D&quot;,</span>
<span class="s2">        ...                    edgecolor=&quot;gray&quot;, alpha=.25)</span>

<span class="s2">    Draw strips of observations on top of a box plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=&quot;tip&quot;, y=&quot;day&quot;, data=tips, whis=np.inf)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;tip&quot;, y=&quot;day&quot;, data=tips,</span>
<span class="s2">        ...                    jitter=True, color=&quot;.3&quot;)</span>

<span class="s2">    Draw strips of observations on top of a violin plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                     inner=None, color=&quot;.8&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.stripplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips, jitter=True)</span>

<span class="s2">    Use :func:`catplot` to combine a :func:`stripplot` and a</span>
<span class="s2">    :class:`FacetGrid`. This allows grouping within additional categorical</span>
<span class="s2">    variables. Using :func:`catplot` is safer than using :class:`FacetGrid`</span>
<span class="s2">    directly, as it ensures synchronization of variable order across facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;sex&quot;, y=&quot;total_bill&quot;,</span>
<span class="s2">        ...                 hue=&quot;smoker&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                 data=tips, kind=&quot;strip&quot;,</span>
<span class="s2">        ...                 jitter=True,</span>
<span class="s2">        ...                 height=4, aspect=.7);</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>


<div class="viewcode-block" id="swarmplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.swarmplot">[docs]</a><span class="k">def</span> <span class="nf">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="s2">&quot;split&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">dodge</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The `split` parameter has been renamed to `dodge`.&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_SwarmPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                            <span class="n">dodge</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;zorder&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">edgecolor</span> <span class="o">==</span> <span class="s2">&quot;gray&quot;</span><span class="p">:</span>
        <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">gray</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">size</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                       <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">))</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="n">swarmplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Draw a categorical scatterplot with non-overlapping points.</span>

<span class="s2">    This function is similar to :func:`stripplot`, but the points are adjusted</span>
<span class="s2">    (only along the categorical axis) so that they don&#39;t overlap. This gives a</span>
<span class="s2">    better representation of the distribution of values, but it does not scale</span>
<span class="s2">    well to large numbers of observations. This style of plot is sometimes</span>
<span class="s2">    called a &quot;beeswarm&quot;.</span>

<span class="s2">    A swarm plot can be drawn on its own, but it is also a good complement</span>
<span class="s2">    to a box or violin plot in cases where you want to show all observations</span>
<span class="s2">    along with some representation of the underlying distribution.</span>

<span class="s2">    Arranging the points properly requires an accurate transformation between</span>
<span class="s2">    data and point coordinates. This means that non-default axis limits must</span>
<span class="s2">    be set *before* drawing the plot.</span>

<span class="s2">    </span><span class="si">{main_api_narrative}</span><span class="s2"></span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{categorical_data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    dodge : bool, optional</span>
<span class="s2">        When using ``hue`` nesting, setting this to ``True`` will separate</span>
<span class="s2">        the strips for different hue levels along the categorical axis.</span>
<span class="s2">        Otherwise, the points for each level will be plotted in one swarm.</span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    size : float, optional</span>
<span class="s2">        Diameter of the markers, in points. (Although ``plt.scatter`` is used</span>
<span class="s2">        to draw the points, the ``size`` argument here takes a &quot;normal&quot;</span>
<span class="s2">        markersize and not size^2 like ``plt.scatter``.</span>
<span class="s2">    edgecolor : matplotlib color, &quot;gray&quot; is special-cased, optional</span>
<span class="s2">        Color of the lines around each point. If you pass ``&quot;gray&quot;``, the</span>
<span class="s2">        brightness is determined by the color palette used for the body</span>
<span class="s2">        of the points.</span>
<span class="s2">    </span><span class="si">{linewidth}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{ax_in}</span><span class="s2"></span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    </span><span class="si">{ax_out}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    </span><span class="si">{boxplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{violinplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{stripplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{catplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Draw a single horizontal swarm plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;whitegrid&quot;)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=tips[&quot;total_bill&quot;])</span>

<span class="s2">    Group the swarms by a categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips)</span>

<span class="s2">    Draw horizontal swarms:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;total_bill&quot;, y=&quot;day&quot;, data=tips)</span>

<span class="s2">    Color the points using a second categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;, data=tips)</span>

<span class="s2">    Split each level of the ``hue`` variable along the categorical axis:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                    data=tips, palette=&quot;Set2&quot;, dodge=True)</span>

<span class="s2">    Control swarm order by passing an explicit order:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;time&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="s2">        ...                    order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>

<span class="s2">    Plot using larger points:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;time&quot;, y=&quot;tip&quot;, data=tips, size=6)</span>

<span class="s2">    Draw swarms of observations on top of a box plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.boxplot(x=&quot;tip&quot;, y=&quot;day&quot;, data=tips, whis=np.inf)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;tip&quot;, y=&quot;day&quot;, data=tips, color=&quot;.2&quot;)</span>

<span class="s2">    Draw swarms of observations on top of a violin plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.violinplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips, inner=None)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.swarmplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                    color=&quot;white&quot;, edgecolor=&quot;gray&quot;)</span>

<span class="s2">    Use :func:`catplot` to combine a :func:`swarmplot` and a</span>
<span class="s2">    :class:`FacetGrid`. This allows grouping within additional categorical</span>
<span class="s2">    variables. Using :func:`catplot` is safer than using :class:`FacetGrid`</span>
<span class="s2">    directly, as it ensures synchronization of variable order across facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;sex&quot;, y=&quot;total_bill&quot;,</span>
<span class="s2">        ...                 hue=&quot;smoker&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                 data=tips, kind=&quot;swarm&quot;,</span>
<span class="s2">        ...                 height=4, aspect=.7);</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>


<div class="viewcode-block" id="barplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.barplot">[docs]</a><span class="k">def</span> <span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">estimator</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
            <span class="n">errcolor</span><span class="o">=</span><span class="s2">&quot;.26&quot;</span><span class="p">,</span> <span class="n">errwidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_BarPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                          <span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span>
                          <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span>
                          <span class="n">errcolor</span><span class="p">,</span> <span class="n">errwidth</span><span class="p">,</span> <span class="n">capsize</span><span class="p">,</span> <span class="n">dodge</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="n">barplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Show point estimates and confidence intervals as rectangular bars.</span>

<span class="s2">    A bar plot represents an estimate of central tendency for a numeric</span>
<span class="s2">    variable with the height of each rectangle and provides some indication of</span>
<span class="s2">    the uncertainty around that estimate using error bars. Bar plots include 0</span>
<span class="s2">    in the quantitative axis range, and they are a good choice when 0 is a</span>
<span class="s2">    meaningful value for the quantitative variable, and you want to make</span>
<span class="s2">    comparisons against it.</span>

<span class="s2">    For datasets where 0 is not a meaningful value, a point plot will allow you</span>
<span class="s2">    to focus on differences between levels of one or more categorical</span>
<span class="s2">    variables.</span>

<span class="s2">    It is also important to keep in mind that a bar plot shows only the mean</span>
<span class="s2">    (or other estimator) value, but in many cases it may be more informative to</span>
<span class="s2">    show the distribution of values at each level of the categorical variables.</span>
<span class="s2">    In that case, other approaches such as a box or violin plot may be more</span>
<span class="s2">    appropriate.</span>

<span class="s2">    </span><span class="si">{main_api_narrative}</span><span class="s2"></span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{categorical_data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{stat_api_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{saturation}</span><span class="s2"></span>
<span class="s2">    errcolor : matplotlib color</span>
<span class="s2">        Color for the lines that represent the confidence interval.</span>
<span class="s2">    </span><span class="si">{errwidth}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{capsize}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{dodge}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{ax_in}</span><span class="s2"></span>
<span class="s2">    kwargs : key, value mappings</span>
<span class="s2">        Other keyword arguments are passed through to ``plt.bar`` at draw</span>
<span class="s2">        time.</span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    </span><span class="si">{ax_out}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    </span><span class="si">{countplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{pointplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{catplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Draw a set of vertical bar plots grouped by a categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;whitegrid&quot;)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, data=tips)</span>

<span class="s2">    Draw a set of vertical bars with nested grouping by a two variables:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;, data=tips)</span>

<span class="s2">    Draw a set of horizontal bars:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;tip&quot;, y=&quot;day&quot;, data=tips)</span>

<span class="s2">    Control bar order by passing an explicit order:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;time&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="s2">        ...                  order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>

<span class="s2">    Use median as the estimate of central tendency:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; from numpy import median</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;day&quot;, y=&quot;tip&quot;, data=tips, estimator=median)</span>

<span class="s2">    Show the standard error of the mean with the error bars:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;day&quot;, y=&quot;tip&quot;, data=tips, ci=68)</span>

<span class="s2">    Show standard deviation of observations instead of a confidence interval:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;day&quot;, y=&quot;tip&quot;, data=tips, ci=&quot;sd&quot;)</span>

<span class="s2">    Add &quot;caps&quot; to the error bars:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;day&quot;, y=&quot;tip&quot;, data=tips, capsize=.2)</span>

<span class="s2">    Use a different color palette for the bars:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(&quot;size&quot;, y=&quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                  palette=&quot;Blues_d&quot;)</span>

<span class="s2">    Use ``hue`` without changing bar position or width:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; tips[&quot;weekend&quot;] = tips[&quot;day&quot;].isin([&quot;Sat&quot;, &quot;Sun&quot;])</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;weekend&quot;,</span>
<span class="s2">        ...                  data=tips, dodge=False)</span>

<span class="s2">    Plot all bars in a single color:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(&quot;size&quot;, y=&quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                  color=&quot;salmon&quot;, saturation=.5)</span>

<span class="s2">    Use ``plt.bar`` keyword arguments to further change the aesthetic:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.barplot(&quot;day&quot;, &quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                  linewidth=2.5, facecolor=(1, 1, 1, 0),</span>
<span class="s2">        ...                  errcolor=&quot;.2&quot;, edgecolor=&quot;.2&quot;)</span>

<span class="s2">    Use :func:`catplot` to combine a :func:`barplot` and a :class:`FacetGrid`.</span>
<span class="s2">    This allows grouping within additional categorical variables. Using</span>
<span class="s2">    :func:`catplot` is safer than using :class:`FacetGrid` directly, as it</span>
<span class="s2">    ensures synchronization of variable order across facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;sex&quot;, y=&quot;total_bill&quot;,</span>
<span class="s2">        ...                 hue=&quot;smoker&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                 data=tips, kind=&quot;bar&quot;,</span>
<span class="s2">        ...                 height=4, aspect=.7);</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>


<div class="viewcode-block" id="pointplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.pointplot">[docs]</a><span class="k">def</span> <span class="nf">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">estimator</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errwidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">capsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_PointPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                            <span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span>
                            <span class="n">markers</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span> <span class="n">dodge</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span>
                            <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">errwidth</span><span class="p">,</span> <span class="n">capsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="n">pointplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Show point estimates and confidence intervals using scatter plot glyphs.</span>

<span class="s2">    A point plot represents an estimate of central tendency for a numeric</span>
<span class="s2">    variable by the position of scatter plot points and provides some</span>
<span class="s2">    indication of the uncertainty around that estimate using error bars.</span>

<span class="s2">    Point plots can be more useful than bar plots for focusing comparisons</span>
<span class="s2">    between different levels of one or more categorical variables. They are</span>
<span class="s2">    particularly adept at showing interactions: how the relationship between</span>
<span class="s2">    levels of one categorical variable changes across levels of a second</span>
<span class="s2">    categorical variable. The lines that join each point from the same ``hue``</span>
<span class="s2">    level allow interactions to be judged by differences in slope, which is</span>
<span class="s2">    easier for the eyes than comparing the heights of several groups of points</span>
<span class="s2">    or bars.</span>

<span class="s2">    It is important to keep in mind that a point plot shows only the mean (or</span>
<span class="s2">    other estimator) value, but in many cases it may be more informative to</span>
<span class="s2">    show the distribution of values at each level of the categorical variables.</span>
<span class="s2">    In that case, other approaches such as a box or violin plot may be more</span>
<span class="s2">    appropriate.</span>

<span class="s2">    </span><span class="si">{main_api_narrative}</span><span class="s2"></span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{categorical_data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{stat_api_params}</span><span class="s2"></span>
<span class="s2">    markers : string or list of strings, optional</span>
<span class="s2">        Markers to use for each of the ``hue`` levels.</span>
<span class="s2">    linestyles : string or list of strings, optional</span>
<span class="s2">        Line styles to use for each of the ``hue`` levels.</span>
<span class="s2">    dodge : bool or float, optional</span>
<span class="s2">        Amount to separate the points for each level of the ``hue`` variable</span>
<span class="s2">        along the categorical axis.</span>
<span class="s2">    join : bool, optional</span>
<span class="s2">        If ``True``, lines will be drawn between point estimates at the same</span>
<span class="s2">        ``hue`` level.</span>
<span class="s2">    scale : float, optional</span>
<span class="s2">        Scale factor for the plot elements.</span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{errwidth}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{capsize}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{ax_in}</span><span class="s2"></span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    </span><span class="si">{ax_out}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    </span><span class="si">{barplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{catplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Draw a set of vertical point plots grouped by a categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;darkgrid&quot;)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;time&quot;, y=&quot;total_bill&quot;, data=tips)</span>

<span class="s2">    Draw a set of vertical points with nested grouping by a two variables:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;time&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                    data=tips)</span>

<span class="s2">    Separate the points for different hue levels along the categorical axis:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;time&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                    data=tips, dodge=True)</span>

<span class="s2">    Use a different marker and line style for the hue levels:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;time&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                    data=tips,</span>
<span class="s2">        ...                    markers=[&quot;o&quot;, &quot;x&quot;],</span>
<span class="s2">        ...                    linestyles=[&quot;-&quot;, &quot;--&quot;])</span>

<span class="s2">    Draw a set of horizontal points:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;tip&quot;, y=&quot;day&quot;, data=tips)</span>

<span class="s2">    Don&#39;t draw a line connecting each point:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;tip&quot;, y=&quot;day&quot;, data=tips, join=False)</span>

<span class="s2">    Use a different color for a single-layer plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(&quot;time&quot;, y=&quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                    color=&quot;#bb3f3f&quot;)</span>

<span class="s2">    Use a different color palette for the points:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;time&quot;, y=&quot;total_bill&quot;, hue=&quot;smoker&quot;,</span>
<span class="s2">        ...                    data=tips, palette=&quot;Set2&quot;)</span>

<span class="s2">    Control point order by passing an explicit order:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;time&quot;, y=&quot;tip&quot;, data=tips,</span>
<span class="s2">        ...                    order=[&quot;Dinner&quot;, &quot;Lunch&quot;])</span>

<span class="s2">    Use median as the estimate of central tendency:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; from numpy import median</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;day&quot;, y=&quot;tip&quot;, data=tips, estimator=median)</span>

<span class="s2">    Show the standard error of the mean with the error bars:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;day&quot;, y=&quot;tip&quot;, data=tips, ci=68)</span>

<span class="s2">    Show standard deviation of observations instead of a confidence interval:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;day&quot;, y=&quot;tip&quot;, data=tips, ci=&quot;sd&quot;)</span>

<span class="s2">    Add &quot;caps&quot; to the error bars:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.pointplot(x=&quot;day&quot;, y=&quot;tip&quot;, data=tips, capsize=.2)</span>

<span class="s2">    Use :func:`catplot` to combine a :func:`barplot` and a</span>
<span class="s2">    :class:`FacetGrid`. This allows grouping within additional categorical</span>
<span class="s2">    variables. Using :func:`catplot` is safer than using :class:`FacetGrid`</span>
<span class="s2">    directly, as it ensures synchronization of variable order across facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;sex&quot;, y=&quot;total_bill&quot;,</span>
<span class="s2">        ...                 hue=&quot;smoker&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                 data=tips, kind=&quot;point&quot;,</span>
<span class="s2">        ...                 dodge=True,</span>
<span class="s2">        ...                 height=4, aspect=.7);</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>


<div class="viewcode-block" id="countplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.countplot">[docs]</a><span class="k">def</span> <span class="nf">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
              <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">estimator</span> <span class="o">=</span> <span class="nb">len</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">n_boot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">errcolor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">errwidth</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">capsize</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">orient</span> <span class="o">=</span> <span class="s2">&quot;h&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">elif</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">orient</span> <span class="o">=</span> <span class="s2">&quot;v&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot pass values for both `x` and `y`&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Must pass values for either `x` or `y`&quot;</span><span class="p">)</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_BarPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">,</span>
                          <span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span>
                          <span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span>
                          <span class="n">errcolor</span><span class="p">,</span> <span class="n">errwidth</span><span class="p">,</span> <span class="n">capsize</span><span class="p">,</span> <span class="n">dodge</span><span class="p">)</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">value_label</span> <span class="o">=</span> <span class="s2">&quot;count&quot;</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="n">countplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Show the counts of observations in each categorical bin using bars.</span>

<span class="s2">    A count plot can be thought of as a histogram across a categorical, instead</span>
<span class="s2">    of quantitative, variable. The basic API and options are identical to those</span>
<span class="s2">    for :func:`barplot`, so you can compare counts across nested variables.</span>

<span class="s2">    </span><span class="si">{main_api_narrative}</span><span class="s2"></span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{categorical_data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{saturation}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{dodge}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{ax_in}</span><span class="s2"></span>
<span class="s2">    kwargs : key, value mappings</span>
<span class="s2">        Other keyword arguments are passed to ``plt.bar``.</span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    </span><span class="si">{ax_out}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    </span><span class="si">{barplot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{catplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Show value counts for a single categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;darkgrid&quot;)</span>
<span class="s2">        &gt;&gt;&gt; titanic = sns.load_dataset(&quot;titanic&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.countplot(x=&quot;class&quot;, data=titanic)</span>

<span class="s2">    Show value counts for two categorical variables:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.countplot(x=&quot;class&quot;, hue=&quot;who&quot;, data=titanic)</span>

<span class="s2">    Plot the bars horizontally:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.countplot(y=&quot;class&quot;, hue=&quot;who&quot;, data=titanic)</span>

<span class="s2">    Use a different color palette:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.countplot(x=&quot;who&quot;, data=titanic, palette=&quot;Set3&quot;)</span>

<span class="s2">    Use ``plt.bar`` keyword arguments for a different look:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.countplot(x=&quot;who&quot;, data=titanic,</span>
<span class="s2">        ...                    facecolor=(0, 0, 0, 0),</span>
<span class="s2">        ...                    linewidth=5,</span>
<span class="s2">        ...                    edgecolor=sns.color_palette(&quot;dark&quot;, 3))</span>

<span class="s2">    Use :func:`catplot` to combine a :func:`countplot` and a</span>
<span class="s2">    :class:`FacetGrid`. This allows grouping within additional categorical</span>
<span class="s2">    variables. Using :func:`catplot` is safer than using :class:`FacetGrid`</span>
<span class="s2">    directly, as it ensures synchronization of variable order across facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;class&quot;, hue=&quot;who&quot;, col=&quot;survived&quot;,</span>
<span class="s2">        ...                 data=titanic, kind=&quot;count&quot;,</span>
<span class="s2">        ...                 height=4, aspect=.7);</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>


<div class="viewcode-block" id="factorplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.factorplot">[docs]</a><span class="k">def</span> <span class="nf">factorplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Deprecated; please use `catplot` instead.&quot;&quot;&quot;</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;The `factorplot` function has been renamed to `catplot`. The &quot;</span>
        <span class="s2">&quot;original name will be removed in a future release. Please update &quot;</span>
        <span class="s2">&quot;your code. Note that the default `kind` in `factorplot` (`&#39;point&#39;`) &quot;</span>
        <span class="s2">&quot;has changed `&#39;strip&#39;` in `catplot`.&quot;</span>
    <span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;size&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The `size` paramter has been renamed to `height`; &quot;</span>
               <span class="s2">&quot;please update your code.&quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">catplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">col_wrap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">col_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;strip&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">margin_titles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">facet_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="c1"># Handle deprecations</span>
    <span class="k">if</span> <span class="s2">&quot;size&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The `size` paramter has been renamed to `height`; &quot;</span>
               <span class="s2">&quot;please update your code.&quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="c1"># Determine the plotting function</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">plot_func</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">kind</span> <span class="o">+</span> <span class="s2">&quot;plot&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;Plot kind &#39;</span><span class="si">{}</span><span class="s2">&#39; is not recognized&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="c1"># Alias the input variables to determine categorical order and palette</span>
    <span class="c1"># correctly in the case of a count plot</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span>
        <span class="k">elif</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either `x` or `y` must be None for count plots&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="c1"># Determine the order for the whole dataset, which will be used in all</span>
    <span class="c1"># facets to ensure representation of all data in the final plot</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">_CategoricalPlotter</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">)</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">group_names</span>
    <span class="n">hue_order</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">hue_names</span>

    <span class="c1"># Determine the palette to use</span>
    <span class="c1"># (FacetGrid will pass a value for ``color`` to the plotting function</span>
    <span class="c1"># so we need to define ``palette`` to get default behavior for the</span>
    <span class="c1"># categorical functions</span>
    <span class="n">p</span><span class="o">.</span><span class="n">establish_colors</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">!=</span> <span class="s2">&quot;point&quot;</span> <span class="ow">or</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">colors</span>

    <span class="c1"># Determine keyword arguments for the facets</span>
    <span class="n">facet_kws</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">facet_kws</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">facet_kws</span>
    <span class="n">facet_kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
        <span class="n">row_order</span><span class="o">=</span><span class="n">row_order</span><span class="p">,</span> <span class="n">col_order</span><span class="o">=</span><span class="n">col_order</span><span class="p">,</span>
        <span class="n">col_wrap</span><span class="o">=</span><span class="n">col_wrap</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
        <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span>
        <span class="n">legend_out</span><span class="o">=</span><span class="n">legend_out</span><span class="p">,</span> <span class="n">margin_titles</span><span class="o">=</span><span class="n">margin_titles</span><span class="p">,</span>
        <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Determine keyword arguments for the plotting function</span>
    <span class="n">plot_kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="n">hue_order</span><span class="p">,</span>
        <span class="n">orient</span><span class="o">=</span><span class="n">orient</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">plot_kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">]:</span>
        <span class="n">plot_kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Initialize the facets</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">FacetGrid</span><span class="p">(</span><span class="o">**</span><span class="n">facet_kws</span><span class="p">)</span>

    <span class="c1"># Draw the plot onto the facets</span>
    <span class="n">g</span><span class="o">.</span><span class="n">map_dataframe</span><span class="p">(</span><span class="n">plot_func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kws</span><span class="p">)</span>

    <span class="c1"># Special case axis labels for a count type plot</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="n">x_var</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="n">y_var</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">legend</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]):</span>
        <span class="n">hue_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">to_utf8</span><span class="p">,</span> <span class="n">hue_order</span><span class="p">))</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">hue</span><span class="p">,</span> <span class="n">label_order</span><span class="o">=</span><span class="n">hue_order</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">g</span>


<span class="n">catplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Figure-level interface for drawing categorical plots onto a FacetGrid.</span>

<span class="s2">    This function provides access to several axes-level functions that</span>
<span class="s2">    show the relationship between a numerical and one or more categorical</span>
<span class="s2">    variables using one of several visual representations. The ``kind``</span>
<span class="s2">    parameter selects the underlying axes-level function to use:</span>

<span class="s2">    Categorical scatterplots:</span>

<span class="s2">    - :func:`stripplot` (with ``kind=&quot;strip&quot;``; the default)</span>
<span class="s2">    - :func:`swarmplot` (with ``kind=&quot;swarm&quot;``)</span>

<span class="s2">    Categorical distribution plots:</span>

<span class="s2">    - :func:`boxplot` (with ``kind=&quot;box&quot;``)</span>
<span class="s2">    - :func:`violinplot` (with ``kind=&quot;violin&quot;``)</span>
<span class="s2">    - :func:`boxenplot` (with ``kind=&quot;boxen&quot;``)</span>

<span class="s2">    Categorical estimate plots:</span>

<span class="s2">    - :func:`pointplot` (with ``kind=&quot;point&quot;``)</span>
<span class="s2">    - :func:`barplot` (with ``kind=&quot;bar&quot;``)</span>
<span class="s2">    - :func:`countplot` (with ``kind=&quot;count&quot;``)</span>

<span class="s2">    Extra keyword arguments are passed to the underlying function, so you</span>
<span class="s2">    should refer to the documentation for each to see kind-specific options.</span>

<span class="s2">    Note that unlike when using the axes-level functions directly, data must be</span>
<span class="s2">    passed in a long-form DataFrame with variables specified by passing strings</span>
<span class="s2">    to ``x``, ``y``, ``hue``, etc.</span>

<span class="s2">    As in the case with the underlying plot functions, if variables have a</span>
<span class="s2">    ``categorical`` data type, the the levels of the categorical variables, and</span>
<span class="s2">    their order will be inferred from the objects. Otherwise you may have to</span>
<span class="s2">    use alter the dataframe sorting or use the function parameters (``orient``,</span>
<span class="s2">    ``order``, ``hue_order``, etc.) to set up the plot correctly.</span>

<span class="s2">    </span><span class="si">{categorical_narrative}</span><span class="s2"></span>

<span class="s2">    After plotting, the :class:`FacetGrid` with the plot is returned and can</span>
<span class="s2">    be used directly to tweak supporting plot details or add other layers.</span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    </span><span class="si">{string_input_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{long_form_data}</span><span class="s2"></span>
<span class="s2">    row, col : names of variables in ``data``, optional</span>
<span class="s2">        Categorical variables that will determine the faceting of the grid.</span>
<span class="s2">    </span><span class="si">{col_wrap}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{stat_api_params}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order_vars}</span><span class="s2"></span>
<span class="s2">    row_order, col_order : lists of strings, optional</span>
<span class="s2">        Order to organize the rows and/or columns of the grid in, otherwise the</span>
<span class="s2">        orders are inferred from the data objects.</span>
<span class="s2">    kind : string, optional</span>
<span class="s2">        The kind of plot to draw (corresponds to the name of a categorical</span>
<span class="s2">        plotting function. Options are: &quot;point&quot;, &quot;bar&quot;, &quot;strip&quot;, &quot;swarm&quot;,</span>
<span class="s2">        &quot;box&quot;, &quot;violin&quot;, or &quot;boxen&quot;.</span>
<span class="s2">    </span><span class="si">{height}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{aspect}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{orient}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    legend : bool, optional</span>
<span class="s2">        If ``True`` and there is a ``hue`` variable, draw a legend on the plot.</span>
<span class="s2">    </span><span class="si">{legend_out}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{share_xy}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{margin_titles}</span><span class="s2"></span>
<span class="s2">    facet_kws : dict, optional</span>
<span class="s2">        Dictionary of other keyword arguments to pass to :class:`FacetGrid`.</span>
<span class="s2">    kwargs : key, value pairings</span>
<span class="s2">        Other keyword arguments are passed through to the underlying plotting</span>
<span class="s2">        function.</span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    g : :class:`FacetGrid`</span>
<span class="s2">        Returns the :class:`FacetGrid` object with the plot on it for further</span>
<span class="s2">        tweaking.</span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Draw a single facet to use the :class:`FacetGrid` legend placement:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns</span>
<span class="s2">        &gt;&gt;&gt; sns.set(style=&quot;ticks&quot;)</span>
<span class="s2">        &gt;&gt;&gt; exercise = sns.load_dataset(&quot;exercise&quot;)</span>
<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;time&quot;, y=&quot;pulse&quot;, hue=&quot;kind&quot;, data=exercise)</span>

<span class="s2">    Use a different plot kind to visualize the same data:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;time&quot;, y=&quot;pulse&quot;, hue=&quot;kind&quot;,</span>
<span class="s2">        ...                data=exercise, kind=&quot;violin&quot;)</span>

<span class="s2">    Facet along the columns to show a third categorical variable:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;time&quot;, y=&quot;pulse&quot;, hue=&quot;kind&quot;,</span>
<span class="s2">        ...                 col=&quot;diet&quot;, data=exercise)</span>

<span class="s2">    Use a different height and aspect ratio for the facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;time&quot;, y=&quot;pulse&quot;, hue=&quot;kind&quot;,</span>
<span class="s2">        ...                 col=&quot;diet&quot;, data=exercise,</span>
<span class="s2">        ...                 height=5, aspect=.8)</span>

<span class="s2">    Make many column facets and wrap them into the rows of the grid:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; titanic = sns.load_dataset(&quot;titanic&quot;)</span>
<span class="s2">        &gt;&gt;&gt; g = sns.catplot(&quot;alive&quot;, col=&quot;deck&quot;, col_wrap=4,</span>
<span class="s2">        ...                 data=titanic[titanic.deck.notnull()],</span>
<span class="s2">        ...                 kind=&quot;count&quot;, height=2.5, aspect=.8)</span>

<span class="s2">    Plot horizontally and pass other keyword arguments to the plot function:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;age&quot;, y=&quot;embark_town&quot;,</span>
<span class="s2">        ...                 hue=&quot;sex&quot;, row=&quot;class&quot;,</span>
<span class="s2">        ...                 data=titanic[titanic.embark_town.notnull()],</span>
<span class="s2">        ...                 orient=&quot;h&quot;, height=2, aspect=3, palette=&quot;Set3&quot;,</span>
<span class="s2">        ...                 kind=&quot;violin&quot;, dodge=True, cut=0, bw=.2)</span>

<span class="s2">    Use methods on the returned :class:`FacetGrid` to tweak the presentation:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.catplot(x=&quot;who&quot;, y=&quot;survived&quot;, col=&quot;class&quot;,</span>
<span class="s2">        ...                 data=titanic, saturation=.5,</span>
<span class="s2">        ...                 kind=&quot;bar&quot;, ci=None, aspect=.6)</span>
<span class="s2">        &gt;&gt;&gt; (g.set_axis_labels(&quot;&quot;, &quot;Survival Rate&quot;)</span>
<span class="s2">        ...   .set_xticklabels([&quot;Men&quot;, &quot;Women&quot;, &quot;Children&quot;])</span>
<span class="s2">        ...   .set_titles(&quot;{{col_name}} {{col_var}}&quot;)</span>
<span class="s2">        ...   .set(ylim=(0, 1))</span>
<span class="s2">        ...   .despine(left=True))  #doctest: +ELLIPSIS</span>
<span class="s2">        &lt;seaborn.axisgrid.FacetGrid object at 0x...&gt;</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_categorical_docs</span><span class="p">)</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, M. Giantomassi and the AbiPy group.<br/>
      Last updated on Oct 18, 2019.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>